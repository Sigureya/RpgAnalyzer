(function(a,u){typeof exports=="object"&&typeof module<"u"?u(exports):typeof define=="function"&&define.amd?define(["exports"],u):(a=typeof globalThis<"u"?globalThis:a||self,u(a.RpgAnalyzer={}))})(this,function(a){"use strict";const x="bgm",w="se",i="me",A="bgs",E=(e,r)=>r?e===r.code:!1,V="MessageHeader invalid command",j="Invalid Head",B=e=>typeof e[0]=="string"&&e.length===1,h=(e,r,t)=>{const o=[];for(let n=t;n<r.length;n++){const g=r[n];if(E(e,g)&&B(g.parameters))o.push({code:e,indent:g.indent,parameters:[g.parameters[0]]});else break}return o},v=(e,r,t)=>{const o=e[r];if(o&&E(t,o)&&B(o.parameters))return{code:t,indent:o.indent,parameters:[o.parameters[0]]};throw new Error(j,{cause:o})},H=(e,r)=>({head:v(e,r,108),bodys:h(408,e,r+1)}),Q=(e,r)=>({head:v(e,r,355),bodys:h(655,e,r+1)}),O=(e,r)=>{const t=e[r];if(t&&Z(t))return t;throw new Error(V,{cause:t})},Z=e=>!e||e.code!==101||![4,5].includes(e.parameters.length)?!1:typeof e.parameters[0]=="string"&&typeof e.parameters[1]=="number"&&typeof e.parameters[2]=="number"&&typeof e.parameters[3]=="number",U=(e,r)=>({head:O(e,r),bodys:h(401,e,r+1)}),K="ScrollTextHeader invalid command",Y=(e,r)=>{const t=e[r];if(E(105,t))return t;const o={headCode:105,bodyCode:405,index:r};throw new Error(K,{cause:o})},q=(e,r)=>({head:Y(e,r),bodys:h(405,e,r+1)}),X=(e,r=`
`)=>e.map(t=>t.parameters[0]).join(r);class S{constructor(r,t){this.header=r,this.bodies=t}getBodyText(r=`
`){return X(this.getExpandedBodies(),r)}jopinHedderAndBody(){return[this.header,...this.bodies]}joinCommandBodies(){return this.getExpandedBodies()}}class f extends S{constructor(r,t,o){super(t,o),this.bodyCode=r}getExpandedBodies(){return this.bodies}normalizedCommands(){const r={...this.header,code:this.header.code,indent:this.header.indent,parameters:[...this.header.parameters]};return this.bodies.length===0?[r]:[r,this.mergedBody()]}mergedBody(){return{code:this.bodyCode,indent:this.header.indent,parameters:[this.getBodyText()]}}}class M extends S{getExpandedBodies(){return[this.header,...this.bodies]}mergedBody(){return{code:this.header.code,indent:this.header.indent,parameters:[this.getBodyText()]}}normalizedCommands(){return[this.mergedBody()]}}const $="選択肢ヘルプ",ee=e=>e.parameters[0]===$,re=(e,r=[])=>new f(401,e,r),te=(e,r=[])=>new f(405,e,r),oe=(e,r=[])=>ee(e)?new f(408,e,r):new M(e,r),ae=(e,r=[])=>new M(e,r),ce=(e,r,t)=>{const o=U(e,r),n=re(o.head,o.bodys);return t(n)},ne=(e,r,t)=>{const o=q(e,r),n=te(o.head,o.bodys);return t(n)},se=(e,r,t)=>{const o=H(e,r),n=oe(o.head,o.bodys);return t(n)},me=(e,r,t)=>{const o=Q(e,r),n=ae(o.head,o.bodys);return t(n)},c=(e,r,t,o,n)=>o?o(e,r,t):n(e,r,t),p=(e,r)=>e.map((t,o)=>de(e,o,r)),de=(e,r,t)=>{const o=e[r];switch(o.code){case 101:return t.showMessage?ce(e,r,t.showMessage):t.other(o,r,e);case 401:return c(o,r,e,t.showMessageBody,t.other);case 105:return t.showScrollingText?ne(e,r,t.showScrollingText):t.other(o,r,e);case 405:return c(o,r,e,t.showScrollingTextBody,t.other);case 108:return t.comment?se(e,r,t.comment):t.other(o,r,e);case 408:return c(o,r,e,t.commentBody,t.other);case 355:return t.script?me(e,r,t.script):t.other(o,r,e);case 655:return c(o,r,e,t.scriptBody,t.other);case 121:return c(o,r,e,t.controlSwitch,t.other);case 122:return c(o,r,e,t.controlVariable,t.other);case 123:return c(o,r,e,t.controlSelfSwitch,t.other);case 124:return c(o,r,e,t.controlTimer,t.other);case 111:return c(o,r,e,t.conditionalBranch,t.other);case 102:return c(o,r,e,t.showChoices,t.other);case 402:return c(o,r,e,t.choiceWhen,t.other);case 320:return c(o,r,e,t.changeName,t.other);case 325:return c(o,r,e,t.changeProfile,t.other);case 324:return c(o,r,e,t.changeNickname,t.other);case 117:return c(o,r,e,t.commonEvent,t.other);case 118:return c(o,r,e,t.label,t.other);case 119:return c(o,r,e,t.labelJump,t.other);case 132:return c(o,r,e,t.changeBattleBGM,t.other);case 133:return c(o,r,e,t.changeVictoryME,t.other);case 139:return c(o,r,e,t.changeDefeatME,t.other);case 134:return c(o,r,e,t.changeSaveAccess,t.other);case 135:return c(o,r,e,t.changeMenuAccess,t.other);case 136:return c(o,r,e,t.changeEncounter,t.other);case 137:return c(o,r,e,t.changeFormationAccess,t.other);case 138:return c(o,r,e,t.changeWindowColor,t.other);case 223:return c(o,r,e,t.tintScreen,t.other);case 224:return c(o,r,e,t.flashScreen,t.other);case 225:return c(o,r,e,t.shakeScreen,t.other);case 301:return c(o,r,e,t.battleProcessing,t.other);case 230:return c(o,r,e,t.wait,t.other);case 322:return c(o,r,e,t.changeActorImages,t.other);case 125:return c(o,r,e,t.changeGold,t.other);case 212:return c(o,r,e,t.showAnimation,t.other);case 201:return c(o,r,e,t.transferPlayer,t.other);case 202:return c(o,r,e,t.setVehicleLocation,t.other);case 203:return c(o,r,e,t.setEventLocation,t.other);case 353:return c(o,r,e,t.gameover,t.other)}return t.other(o,r,e)},ie={commentBody:()=>[],showMessageBody:()=>[],scriptBody:()=>[],showScrollingTextBody:()=>[],showMessage:e=>e.normalizedCommands(),showScrollingText:e=>e.normalizedCommands(),comment:e=>e.normalizedCommands(),script:e=>e.normalizedCommands(),other:e=>[e]},ue=e=>p(e,ie),he=e=>!!e,T=(e,r)=>e.pages.map((t,o)=>r(t,o,e)),le=(e,r)=>e.events.filter(he).map(t=>T(t,r)),ge=(e,r)=>le(e,r).flat(2),xe=(e,r)=>e.map(t=>T(t,r)),Ee=(e,r)=>e.map((t,o)=>r(t,o,t)),fe=()=>/<([^<>:]+):([^>]*)>/g,pe=(e,r)=>{const t=fe(),o=[];let n;for(;(n=t.exec(e))!==null;)o.push(r(n[1],n[2]));return o},Te=(e,r,t)=>r.map(o=>t(o,e[o],e)),N=(e,r,t)=>Te(e,r,t),m=(e,r)=>({code:e.code,paramIndex:r,value:e.parameters[r]}),Fe=e=>e.folder===w||e.folder===x||e.folder===A||e.folder===i,be=[241,245,249,250,132,133,139,140],k=e=>be.includes(e.code),P=e=>({folder:ye(e)||"",fileName:e.parameters[0].name}),ye=e=>Ce[e.code],Ce={241:x,245:A,249:i,250:w,132:x,133:i,139:i,140:i},l=(e,r,t)=>e.list.filter(k).map(o=>({code:o.code,path:P(o),pageIndex:r,eventId:t.id})),Ie=e=>Ee(e,l).flat(2),we=e=>xe(e,l).flat(2),D=e=>({bgm:e.bgm,bgs:e.bgs,commands:ge(e,l)}),Ae=e=>({map:D(e.map),filename:e.filename,editingName:e.editingName}),Be=e=>({sounds:F(e.sounds),bgm:F([e.battleBgm,e.titleBgm]),me:F([e.defeatMe,e.gameoverMe,e.victoryMe])}),F=e=>e.map((r,t)=>({index:t,path:r.name})),z=(e,r,t)=>({key:e,text:r,id:t.id}),s=(e,r)=>({main:N(e,r,(t,o)=>z(t,o,e)),note:b(e)}),b=e=>pe(e.note,(r,t)=>z(r,t,e)),ve=e=>s(e,["name","nickname","profile"]),Se=e=>s(e,["name"]),Me=e=>s(e,["name"]),Ne=e=>s(e,["name","description","message1","message2"]),ke=e=>s(e,["name","description"]),Pe=e=>s(e,["name","description"]),De=e=>s(e,["name","description"]),ze=e=>s(e,["name","message1","message2","message3","message4"]),y=e=>{const r=ue(e).flat();return p(r,_)},C=e=>T(e,r=>y(r.list)),_={changeName:e=>[m(e,1)],changeNickname:e=>[m(e,1)],changeProfile:e=>[m(e,1)],showChoices:e=>L(e),showScrollingText:e=>[m(e.mergedBody(),0)],showMessage:e=>{const r=e.normalizedCommands(),t=m(r[0],4),o=r[1];return o?[t,m(o,0)]:[t]},choiceWhen(){return[]},comment(e){const r=e.mergedBody();return[m(r,0)]},script:e=>G(),other:()=>[],commentBody:()=>[]},G=e=>[],L=e=>e.parameters[0].map((r,t)=>({code:e.code,paramIndex:t,value:r})),_e=e=>{const r=C(e);return{note:b(e),eventId:e.id,commands:r.flat(2)}},Ge=e=>{const r=C(e);return{troopId:e.id,commands:r.flat(2)}},Le=e=>({eventId:e.id,commands:y(e.list).flat(2)}),Re=e=>p(e,We),d=(e,r,t)=>({folderName:t,command:m(e,r)}),We={changeActorImages:e=>[d(e,1,"characters"),d(e,3,"faces"),d(e,5,"sv_actors")],showPicture:e=>[d(e,1,"pictures")],changeBattleBackground:e=>[d(e,0,"battlebacks1"),d(e,1,"battlebacks2")],changeParallax:e=>[d(e,0,"parallaxes")],changeVehicleImage:e=>[d(e,1,"characters")],other:()=>[]},Je=e=>({key:"battlerName",image:e.battlerName,id:e.id}),R=(e,r,t)=>({key:e,image:r,id:t.id}),W=(e,r)=>N(e,r,(t,o)=>R(t,o,e)),Ve=e=>W(e,["characterName","faceName","battlerName"]),I=(e,r)=>({folder:"characters",key:r,image:e[r].characterName}),J=(e,r,t)=>({folder:t,key:r,image:e[r]}),je=e=>[J(e,"title1Name","titles1"),J(e,"title2Name","titles2"),I(e,"boat"),I(e,"ship"),I(e,"airship")];a.audioPathFromCommands=P,a.collectAudioCommands=l,a.commandChoice=L,a.correctMapEventText=_e,a.expectAudioFromTroop=we,a.extractAudioCFromCommonEvents=Ie,a.extractAudioFromMap=D,a.extractAudioFromMapFileInfo=Ae,a.extractImageData=W,a.extractImageFromActor=Ve,a.extractImageFromEnemy=Je,a.extractImageFromSystem=je,a.extractImagesFromCommands=Re,a.extractNoteText=b,a.extractTextData=s,a.extractTextFromActor=ve,a.extractTextFromArmor=De,a.extractTextFromClass=Me,a.extractTextFromCommonEvent=Le,a.extractTextFromEnemy=Se,a.extractTextFromEventCommands=y,a.extractTextFromEventPages=C,a.extractTextFromItem=ke,a.extractTextFromSkill=Ne,a.extractTextFromState=ze,a.extractTextFromTroop=Ge,a.extractTextFromWeapon=Pe,a.extractTextMapper=_,a.extractedImageItem=R,a.isAudioCommand=k,a.isAudioResource=Fe,a.readScript=G,a.systemAudioFiles=Be,Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=rpg-analyzer.umd.js.map
