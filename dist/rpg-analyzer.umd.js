(function(c,h){typeof exports=="object"&&typeof module<"u"?h(exports):typeof define=="function"&&define.amd?define(["exports"],h):(c=typeof globalThis<"u"?globalThis:c||self,h(c.RpgAnalyzer={}))})(this,function(c){"use strict";const E="bgm",w="se",i="me",I="bgs",x=(e,t)=>t?e===t.code:!1,R="MessageHeader invalid command",V="Invalid Head",S=e=>typeof e[0]=="string"&&e.length===1,u=(e,t,r)=>{const o=[];for(let n=r;n<t.length;n++){const g=t[n];if(x(e,g)&&S(g.parameters))o.push({code:e,indent:g.indent,parameters:[g.parameters[0]]});else break}return o},v=(e,t,r)=>{const o=e[t];if(o&&x(r,o)&&S(o.parameters))return{code:r,indent:o.indent,parameters:[o.parameters[0]]};throw new Error(V,{cause:o})},J=(e,t)=>({head:v(e,t,108),bodys:u(408,e,t+1)}),j=(e,t)=>({head:v(e,t,355),bodys:u(655,e,t+1)}),H=(e,t)=>{const r=e[t];if(r&&O(r))return r;throw new Error(R,{cause:r})},O=e=>!e||e.code!==101||![4,5].includes(e.parameters.length)?!1:typeof e.parameters[0]=="string"&&typeof e.parameters[1]=="number"&&typeof e.parameters[2]=="number"&&typeof e.parameters[3]=="number",Q=(e,t)=>({head:H(e,t),bodys:u(401,e,t+1)}),Z="ScrollTextHeader invalid command",U=(e,t)=>{const r=e[t];if(x(105,r))return r;const o={headCode:105,bodyCode:405,index:t};throw new Error(Z,{cause:o})},q=(e,t)=>({head:U(e,t),bodys:u(405,e,t+1)}),K=(e,t=`
`)=>e.map(r=>r.parameters[0]).join(t);class M{constructor(t,r){this.header=t,this.bodies=r}getBodyText(t=`
`){return K(this.getExpandedBodies(),t)}jopinHedderAndBody(){return[this.header,...this.bodies]}joinCommandBodies(){return this.getExpandedBodies()}}class p extends M{constructor(t,r,o){super(r,o),this.bodyCode=t}getExpandedBodies(){return this.bodies}normalizedCommands(){const t={...this.header,code:this.header.code,indent:this.header.indent,parameters:[...this.header.parameters]};return this.bodies.length===0?[t]:[t,this.mergedBody()]}mergedBody(){return{code:this.bodyCode,indent:this.header.indent,parameters:[this.getBodyText()]}}}class N extends M{getExpandedBodies(){return[this.header,...this.bodies]}mergedBody(){return{code:this.header.code,indent:this.header.indent,parameters:[this.getBodyText()]}}normalizedCommands(){return[this.mergedBody()]}}const Y="選択肢ヘルプ",X=e=>e.parameters[0]===Y,$=(e,t=[])=>new p(401,e,t),ee=(e,t=[])=>new p(405,e,t),re=(e,t=[])=>X(e)?new p(408,e,t):new N(e,t),te=(e,t=[])=>new N(e,t),oe=(e,t,r)=>{const o=Q(e,t),n=$(o.head,o.bodys);return r(n)},ae=(e,t,r)=>{const o=q(e,t),n=ee(o.head,o.bodys);return r(n)},ce=(e,t,r)=>{const o=J(e,t),n=re(o.head,o.bodys);return r(n)},ne=(e,t,r)=>{const o=j(e,t),n=te(o.head,o.bodys);return r(n)},a=(e,t,r,o,n)=>o?o(e,t,r):n(e,t,r),f=(e,t)=>e.map((r,o)=>se(e,o,t)),se=(e,t,r)=>{const o=e[t];switch(o.code){case 101:return r.showMessage?oe(e,t,r.showMessage):r.other(o,t,e);case 401:return a(o,t,e,r.showMessageBody,r.other);case 105:return r.showScrollingText?ae(e,t,r.showScrollingText):r.other(o,t,e);case 405:return a(o,t,e,r.showScrollingTextBody,r.other);case 102:return a(o,t,e,r.showChoices,r.other);case 402:return a(o,t,e,r.choiceWhen,r.other);case 108:return r.comment?ce(e,t,r.comment):r.other(o,t,e);case 408:return a(o,t,e,r.commentBody,r.other);case 355:return r.script?ne(e,t,r.script):r.other(o,t,e);case 655:return a(o,t,e,r.scriptBody,r.other);case 111:return a(o,t,e,r.conditionalBranch,r.other);case 121:return a(o,t,e,r.controlSwitch,r.other);case 122:return a(o,t,e,r.controlVariable,r.other);case 123:return a(o,t,e,r.controlSelfSwitch,r.other);case 124:return a(o,t,e,r.controlTimer,r.other);case 117:return a(o,t,e,r.commonEvent,r.other);case 134:return a(o,t,e,r.changeSaveAccess,r.other);case 135:return a(o,t,e,r.changeMenuAccess,r.other);case 136:return a(o,t,e,r.changeEncounter,r.other);case 137:return a(o,t,e,r.changeFormationAccess,r.other);case 320:return a(o,t,e,r.changeName,r.other);case 325:return a(o,t,e,r.changeProfile,r.other);case 324:return a(o,t,e,r.changeNickname,r.other);case 322:return a(o,t,e,r.changeActorImages,r.other);case 323:return a(o,t,e,r.changeVehicleImage,r.other);case 132:return a(o,t,e,r.changeBattleBGM,r.other);case 133:return a(o,t,e,r.changeVictoryME,r.other);case 139:return a(o,t,e,r.changeDefeatME,r.other);case 241:return a(o,t,e,r.playBGM,r.other);case 242:return a(o,t,e,r.fadeOutBGM,r.other);case 250:return a(o,t,e,r.playSE,r.other);case 251:return a(o,t,e,r.stopSE,r.other);case 249:return a(o,t,e,r.playME,r.other);case 118:return a(o,t,e,r.label,r.other);case 119:return a(o,t,e,r.labelJump,r.other);case 138:return a(o,t,e,r.changeWindowColor,r.other);case 223:return a(o,t,e,r.tintScreen,r.other);case 224:return a(o,t,e,r.flashScreen,r.other);case 225:return a(o,t,e,r.shakeScreen,r.other);case 231:return a(o,t,e,r.showPicture,r.other);case 232:return a(o,t,e,r.movePicture,r.other);case 233:return a(o,t,e,r.rotatePicture,r.other);case 234:return a(o,t,e,r.tintPicture,r.other);case 235:return a(o,t,e,r.erasePicture,r.other);case 301:return a(o,t,e,r.battleProcessing,r.other);case 230:return a(o,t,e,r.wait,r.other);case 353:return a(o,t,e,r.gameover,r.other);case 284:return a(o,t,e,r.changeParallax,r.other);case 283:return a(o,t,e,r.changeBattleBackground,r.other);case 261:return a(o,t,e,r.playMovie,r.other);case 211:return a(o,t,e,r.changeTransparency,r.other);case 236:return a(o,t,e,r.setWeatherEffects,r.other);case 125:return a(o,t,e,r.changeGold,r.other);case 212:return a(o,t,e,r.showAnimation,r.other);case 201:return a(o,t,e,r.transferPlayer,r.other);case 202:return a(o,t,e,r.setVehicleLocation,r.other);case 203:return a(o,t,e,r.setEventLocation,r.other);default:return r.other(o,t,e)}},me={commentBody:()=>[],showMessageBody:()=>[],scriptBody:()=>[],showScrollingTextBody:()=>[],showMessage:e=>e.normalizedCommands(),showScrollingText:e=>e.normalizedCommands(),comment:e=>e.normalizedCommands(),script:e=>e.normalizedCommands(),other:e=>[e]},de=e=>f(e,me),ie=e=>!!e,T=(e,t)=>e.pages.map((r,o)=>t(r,o,e)),he=(e,t)=>e.events.filter(ie).map(r=>T(r,t)),ue=(e,t)=>he(e,t).flat(2),le=(e,t)=>e.map(r=>T(r,t)),ge=(e,t)=>e.map((r,o)=>t(r,o,r)),Ee=()=>/<([^<>:]+):([^>]*)>/g,xe=(e,t)=>{const r=Ee(),o=[];let n;for(;(n=r.exec(e))!==null;)o.push(t(n[1],n[2]));return o},pe=(e,t,r)=>t.map(o=>r(o,e[o],e)),fe=(e,t,r)=>pe(e,t,r),m=(e,t)=>({code:e.code,paramIndex:t,value:e.parameters[t]}),Te=e=>e.folder===w||e.folder===E||e.folder===I||e.folder===i,Fe=[241,245,249,250,132,133,139,140],P=e=>Fe.includes(e.code),k=e=>({folder:ye(e)||"",fileName:e.parameters[0].name}),ye=e=>be[e.code],be={241:E,245:I,249:i,250:w,132:E,133:i,139:i,140:i},l=(e,t,r)=>e.list.filter(P).map(o=>({code:o.code,path:k(o),pageIndex:t,eventId:r.id})),Ce=e=>ge(e,l).flat(2),Be=e=>le(e,l).flat(2),D=e=>({bgm:e.bgm,bgs:e.bgs,commands:ue(e,l)}),Ae=e=>({map:D(e.map),filename:e.filename,editingName:e.editingName}),we=e=>({sounds:F(e.sounds),bgm:F([e.battleBgm,e.titleBgm]),me:F([e.defeatMe,e.gameoverMe,e.victoryMe])}),F=e=>e.map((t,r)=>({index:r,path:t.name})),G=(e,t,r)=>({key:e,text:t,id:r.id}),s=(e,t)=>({main:fe(e,t,(r,o)=>G(r,o,e)),note:y(e)}),y=e=>xe(e.note,(t,r)=>G(t,r,e)),Ie=e=>s(e,["name","nickname","profile"]),Se=e=>s(e,["name"]),ve=e=>s(e,["name"]),Me=e=>s(e,["name","description","message1","message2"]),Ne=e=>s(e,["name","description"]),Pe=e=>s(e,["name","description"]),ke=e=>s(e,["name","description"]),De=e=>s(e,["name","message1","message2","message3","message4"]),b=e=>{const t=de(e).flat();return f(t,L)},C=e=>T(e,t=>b(t.list)),L={changeName:e=>[m(e,1)],changeNickname:e=>[m(e,1)],changeProfile:e=>[m(e,1)],showChoices:e=>_(e),showScrollingText:e=>[m(e.mergedBody(),0)],showMessage:e=>{const t=e.normalizedCommands(),r=m(t[0],4),o=t[1];return o?[r,m(o,0)]:[r]},choiceWhen(){return[]},comment(e){const t=e.mergedBody();return[m(t,0)]},script:e=>W(),other:()=>[],commentBody:()=>[]},W=e=>[],_=e=>e.parameters[0].map((t,r)=>({code:e.code,paramIndex:r,value:t})),Ge=e=>{const t=C(e);return{note:y(e),eventId:e.id,commands:t.flat(2)}},Le=e=>{const t=C(e);return{troopId:e.id,commands:t.flat(2)}},We=e=>({eventId:e.id,commands:b(e.list).flat(2)}),_e=e=>f(e,ze),d=(e,t,r)=>({folderName:r,command:m(e,t)}),ze={changeActorImages:e=>[d(e,1,"characters"),d(e,3,"faces"),d(e,5,"sv_actors")],showPicture:e=>[d(e,1,"pictures")],changeBattleBackground:e=>[d(e,0,"battlebacks1"),d(e,1,"battlebacks2")],changeParallax:e=>[d(e,0,"parallaxes")],changeVehicleImage:e=>[d(e,1,"characters")],other:()=>[]},Re=e=>({key:"battlerName",image:e.battlerName,id:e.id}),B=(e,t,r)=>({folder:r,key:t,image:e[t],id:e.id}),Ve=e=>[B(e,"faceName","faces"),B(e,"characterName","characters"),B(e,"battlerName","sv_actors")],A=(e,t)=>({folder:"characters",key:t,image:e[t].characterName}),z=(e,t,r)=>({folder:r,key:t,image:e[t]}),Je=e=>[z(e,"title1Name","titles1"),z(e,"title2Name","titles2"),A(e,"boat"),A(e,"ship"),A(e,"airship")];c.audioPathFromCommands=k,c.collectAudioCommands=l,c.commandChoice=_,c.correctMapEventText=Ge,c.expectAudioFromTroop=Be,c.extractAudioCFromCommonEvents=Ce,c.extractAudioFromMap=D,c.extractAudioFromMapFileInfo=Ae,c.extractImageFromActor=Ve,c.extractImageFromEnemy=Re,c.extractImageFromSystem=Je,c.extractImagesFromCommands=_e,c.extractNoteText=y,c.extractTextData=s,c.extractTextFromActor=Ie,c.extractTextFromArmor=ke,c.extractTextFromClass=ve,c.extractTextFromCommonEvent=We,c.extractTextFromEnemy=Se,c.extractTextFromEventCommands=b,c.extractTextFromEventPages=C,c.extractTextFromItem=Ne,c.extractTextFromSkill=Me,c.extractTextFromState=De,c.extractTextFromTroop=Le,c.extractTextFromWeapon=Pe,c.extractTextMapper=L,c.isAudioCommand=P,c.isAudioResource=Te,c.readScript=W,c.systemAudioFiles=we,Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=rpg-analyzer.umd.js.map
