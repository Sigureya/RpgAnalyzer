(function(c,u){typeof exports=="object"&&typeof module<"u"?u(exports):typeof define=="function"&&define.amd?define(["exports"],u):(c=typeof globalThis<"u"?globalThis:c||self,u(c.RpgAnalyzer={}))})(this,function(c){"use strict";const x="bgm",M="se",d="me",S="bgs",b=(e,t)=>t?e===t.code:!1,Z="MessageHeader invalid command",$="Invalid Head",V=e=>typeof e[0]=="string"&&e.length===1,l=(e,t,r)=>{const a=[];for(let n=r;n<t.length;n++){const f=t[n];if(b(e,f)&&V(f.parameters))a.push({code:e,indent:f.indent,parameters:[f.parameters[0]]});else break}return a},P=(e,t,r)=>{const a=e[t];if(a&&b(r,a)&&V(a.parameters))return{code:r,indent:a.indent,parameters:[a.parameters[0]]};throw new Error($,{cause:a})},ee=(e,t)=>({head:P(e,t,108),bodys:l(408,e,t+1)}),re=(e,t)=>({head:P(e,t,355),bodys:l(655,e,t+1)}),te=(e,t)=>{const r=e[t];if(r&&ae(r))return r;throw new Error(Z,{cause:r})},ae=e=>!e||e.code!==101||![4,5].includes(e.parameters.length)?!1:typeof e.parameters[0]=="string"&&typeof e.parameters[1]=="number"&&typeof e.parameters[2]=="number"&&typeof e.parameters[3]=="number",oe=(e,t)=>({head:te(e,t),bodys:l(401,e,t+1)}),ce="ScrollTextHeader invalid command",ne=(e,t)=>{const r=e[t];if(b(105,r))return r;const a={headCode:105,bodyCode:405,index:t};throw new Error(ce,{cause:a})},se=(e,t)=>({head:ne(e,t),bodys:l(405,e,t+1)}),me=(e,t=`
`)=>e.map(r=>r.parameters[0]).join(t);class R{constructor(t,r){this.header=t,this.bodies=r}getBodyText(t=`
`){return me(this.getExpandedBodies(),t)}jopinHedderAndBody(){return[this.header,...this.bodies]}joinCommandBodies(){return this.getExpandedBodies()}}class p extends R{constructor(t,r,a){super(r,a),this.bodyCode=t}getExpandedBodies(){return this.bodies}normalizedCommands(){const t={...this.header,code:this.header.code,indent:this.header.indent,parameters:[...this.header.parameters]};return this.bodies.length===0?[t]:[t,this.mergedBody()]}mergedBody(){return{code:this.bodyCode,indent:this.header.indent,parameters:[this.getBodyText()]}}}class _ extends R{getExpandedBodies(){return[this.header,...this.bodies]}mergedBody(){return{code:this.header.code,indent:this.header.indent,parameters:[this.getBodyText()]}}normalizedCommands(){return[this.mergedBody()]}}const ie="選択肢ヘルプ",de=e=>e.parameters[0]===ie,ue=(e,t=[])=>new p(401,e,t),le=(e,t=[])=>new p(405,e,t),he=(e,t=[])=>de(e)?new p(408,e,t):new _(e,t),ge=(e,t=[])=>new _(e,t),Ee=(e,t,r)=>{const a=oe(e,t),n=ue(a.head,a.bodys);return r(n)},fe=(e,t,r)=>{const a=se(e,t),n=le(a.head,a.bodys);return r(n)},xe=(e,t,r)=>{const a=ee(e,t),n=he(a.head,a.bodys);return r(n)},be=(e,t,r)=>{const a=re(e,t),n=ge(a.head,a.bodys);return r(n)},o=(e,t,r,a,n)=>a?a(e,t,r):n(e,t,r),F=(e,t)=>e.map((r,a)=>pe(e,a,t)),pe=(e,t,r)=>{const a=e[t];switch(a.code){case 101:return r.showMessage?Ee(e,t,r.showMessage):r.other(a,t,e);case 401:return o(a,t,e,r.showMessageBody,r.other);case 105:return r.showScrollingText?fe(e,t,r.showScrollingText):r.other(a,t,e);case 405:return o(a,t,e,r.showScrollingTextBody,r.other);case 102:return o(a,t,e,r.showChoices,r.other);case 402:return o(a,t,e,r.choiceWhen,r.other);case 108:return r.comment?xe(e,t,r.comment):r.other(a,t,e);case 408:return o(a,t,e,r.commentBody,r.other);case 355:return r.script?be(e,t,r.script):r.other(a,t,e);case 655:return o(a,t,e,r.scriptBody,r.other);case 111:return o(a,t,e,r.conditionalBranch,r.other);case 121:return o(a,t,e,r.controlSwitch,r.other);case 122:return o(a,t,e,r.controlVariable,r.other);case 123:return o(a,t,e,r.controlSelfSwitch,r.other);case 124:return o(a,t,e,r.controlTimer,r.other);case 117:return o(a,t,e,r.commonEvent,r.other);case 134:return o(a,t,e,r.changeSaveAccess,r.other);case 135:return o(a,t,e,r.changeMenuAccess,r.other);case 136:return o(a,t,e,r.changeEncounter,r.other);case 137:return o(a,t,e,r.changeFormationAccess,r.other);case 320:return o(a,t,e,r.changeName,r.other);case 325:return o(a,t,e,r.changeProfile,r.other);case 324:return o(a,t,e,r.changeNickname,r.other);case 322:return o(a,t,e,r.changeActorImages,r.other);case 323:return o(a,t,e,r.changeVehicleImage,r.other);case 132:return o(a,t,e,r.changeBattleBGM,r.other);case 133:return o(a,t,e,r.changeVictoryME,r.other);case 139:return o(a,t,e,r.changeDefeatME,r.other);case 241:return o(a,t,e,r.playBGM,r.other);case 242:return o(a,t,e,r.fadeOutBGM,r.other);case 250:return o(a,t,e,r.playSE,r.other);case 251:return o(a,t,e,r.stopSE,r.other);case 249:return o(a,t,e,r.playME,r.other);case 118:return o(a,t,e,r.label,r.other);case 119:return o(a,t,e,r.labelJump,r.other);case 138:return o(a,t,e,r.changeWindowColor,r.other);case 223:return o(a,t,e,r.tintScreen,r.other);case 224:return o(a,t,e,r.flashScreen,r.other);case 225:return o(a,t,e,r.shakeScreen,r.other);case 231:return o(a,t,e,r.showPicture,r.other);case 232:return o(a,t,e,r.movePicture,r.other);case 233:return o(a,t,e,r.rotatePicture,r.other);case 234:return o(a,t,e,r.tintPicture,r.other);case 235:return o(a,t,e,r.erasePicture,r.other);case 301:return o(a,t,e,r.battleProcessing,r.other);case 230:return o(a,t,e,r.wait,r.other);case 353:return o(a,t,e,r.gameover,r.other);case 284:return o(a,t,e,r.changeParallax,r.other);case 283:return o(a,t,e,r.changeBattleBackground,r.other);case 261:return o(a,t,e,r.playMovie,r.other);case 211:return o(a,t,e,r.changeTransparency,r.other);case 236:return o(a,t,e,r.setWeatherEffects,r.other);case 125:return o(a,t,e,r.changeGold,r.other);case 212:return o(a,t,e,r.showAnimation,r.other);case 201:return o(a,t,e,r.transferPlayer,r.other);case 202:return o(a,t,e,r.setVehicleLocation,r.other);case 203:return o(a,t,e,r.setEventLocation,r.other);default:return r.other(a,t,e)}},Fe={commentBody:()=>[],showMessageBody:()=>[],scriptBody:()=>[],showScrollingTextBody:()=>[],showMessage:e=>e.normalizedCommands(),showScrollingText:e=>e.normalizedCommands(),comment:e=>e.normalizedCommands(),script:e=>e.normalizedCommands(),other:e=>[e]},Ce=e=>F(e,Fe),Te=e=>!!e,C=(e,t)=>e.pages.map((r,a)=>t(r,a,e)),k=(e,t)=>e.events.filter(Te).map(r=>C(r,t)),W=(e,t)=>k(e,t).flat(2),T=(e,t)=>e.map(r=>C(r,t)),I=(e,t)=>e.map(r=>t(r,0,r)),L=(e,t)=>t.includes(e.code),Ie=e=>L(e,ve),ve=[241,245,249,250,132,133,139,140],ye=e=>L(e,Ae),Ae=[231,322,323,284,283],m=(e,t)=>({code:e.code,paramIndex:t,value:e.parameters[t]}),Be=()=>/<([^<>:]+):([^>]*)>/g,Ne=(e,t)=>{const r=Be(),a=[];let n;for(;(n=r.exec(e))!==null;)a.push(t(n[1],n[2]));return a},we=(e,t,r)=>t.map(a=>r(a,e[a],e)),Me=(e,t,r)=>we(e,t,r),Se=e=>e.folder===M||e.folder===x||e.folder===S||e.folder===d,D=e=>({folder:Ve(e)||"",fileName:e.parameters[0].name}),Ve=e=>Pe[e.code],Pe={241:x,245:S,249:d,250:M,132:x,133:d,139:d,140:d},h=(e,t,r)=>e.list.filter(Ie).map(a=>({code:a.code,path:D(a),pageIndex:t,eventId:r.id})),Re=e=>I(e,h).flat(2),_e=e=>T(e,h).flat(2),G=e=>({bgm:e.bgm,bgs:e.bgs,commands:W(e,h)}),ke=e=>({map:G(e.map),filename:e.filename,editingName:e.editingName}),We=e=>({sounds:v(e.sounds),bgm:v([e.battleBgm,e.titleBgm]),me:v([e.defeatMe,e.gameoverMe,e.victoryMe])}),v=e=>e.map((t,r)=>({index:r,path:t.name})),O=(e,t,r)=>({key:e,text:t,id:r.id}),s=(e,t)=>({main:Me(e,t,(r,a)=>O(r,a,e)),note:y(e)}),y=e=>Ne(e.note,(t,r)=>O(t,r,e)),Le=e=>s(e,["name","nickname","profile"]),De=e=>s(e,["name"]),Ge=e=>s(e,["name"]),Oe=e=>s(e,["name","description","message1","message2"]),ze=e=>s(e,["name","description"]),je=e=>s(e,["name","description"]),He=e=>s(e,["name","description"]),Je=e=>s(e,["name","message1","message2","message3","message4"]),A=e=>{const t=Ce(e).flat();return F(t,z)},B=e=>C(e,t=>A(t.list)),z={changeName:e=>[m(e,1)],changeNickname:e=>[m(e,1)],changeProfile:e=>[m(e,1)],showChoices:e=>H(e),showScrollingText:e=>[m(e.mergedBody(),0)],showMessage:e=>{const t=e.normalizedCommands(),r=m(t[0],4),a=t[1];return a?[r,m(a,0)]:[r]},choiceWhen(){return[]},comment(e){const t=e.mergedBody();return[m(t,0)]},script:e=>j(),other:()=>[],commentBody:()=>[]},j=e=>[],H=e=>e.parameters[0].map((t,r)=>({code:e.code,paramIndex:r,value:t})),Ye=e=>{const t=B(e);return{note:y(e),eventId:e.id,commands:t.flat(2)}},qe=e=>{const t=B(e);return{troopId:e.id,commands:t.flat(2)}},Ke=e=>({eventId:e.id,commands:A(e.list).flat(2)}),Qe=e=>({key:"battlerName",image:e.battlerName,id:e.id}),N=(e,t,r)=>({folder:r,key:t,image:e[t],id:e.id}),Xe=e=>[N(e,"faceName","faces"),N(e,"characterName","characters"),N(e,"battlerName","sv_actors")],w=(e,t)=>({folder:"characters",key:t,image:e[t].characterName}),J=(e,t,r)=>({folder:r,key:t,image:e[t]}),Ue=e=>[J(e,"title1Name","titles1"),J(e,"title2Name","titles2"),w(e,"boat"),w(e,"ship"),w(e,"airship")],Y=e=>F(e,Ze),i=(e,t,r)=>({folderName:r,command:m(e,t)}),Ze={changeActorImages:e=>[i(e,1,"characters"),i(e,3,"faces"),i(e,5,"sv_actors")],showPicture:e=>[i(e,1,"pictures")],changeBattleBackground:e=>[i(e,0,"battlebacks1"),i(e,1,"battlebacks2")],changeParallax:e=>[i(e,0,"parallaxes")],changeVehicleImage:e=>[i(e,1,"characters")],other:()=>[]},$e=e=>T(e,g).flat(2),er=e=>I(e,g).flat(2),rr=e=>({commands:W(e,g),background1:{folderName:"battlebacks1",fileName:e.battleback1Name},background2:{folderName:"battlebacks2",fileName:e.battleback2Name},parallax:{folderName:"parallaxes",fileName:e.parallaxName}}),g=(e,t,r)=>Y(e.list.filter(ye)).flatMap(n=>ar(n,t,r)),tr=(e,t,r)=>({folderName:e.folderName,command:e.command,eventId:t.id,pageIndex:r,eventName:t.name}),ar=(e,t,r)=>e.map(a=>tr(a,r,t)),or=1,cr={331:2,332:2,201:0,202:1,285:2,301:0},nr={331:[4],332:[4],201:[1,2,3],202:[2,3,4],285:[0],301:[1]},q=e=>e.filter(Q).flatMap(K),K=e=>{const t=nr[e.code];if(t===void 0)throw new Error(`code${e.code} is not supported`);return t.map(r=>({eventCode:e.code,index:r,variableId:e.parameters[r]}))},Q=e=>{const t=cr[e.code];return t===void 0?!1:e.parameters[t]===or},sr=e=>e.code===103||e.code===104||e.code===285||e.code===122,mr=e=>e.code===122?X(e):[{variableId:e.parameters[0],code:e.code}],X=e=>{const t=e.parameters[0],r=e.parameters[1];return Array.from({length:r-t+1},(a,n)=>({variableId:n+t,code:122}))},E=(e,t,r)=>{const a=q(e.list);return{pageIndex:t,eventId:r.id,commands:a}},ir=e=>k(e,(t,r,a)=>({page:E(t,r,a),conditions:U(t.conditions)})).flat(2),U=e=>({variableId:e.variableId,valid:e.variableValid,value:e.variableValue}),dr=e=>I(e,E),ur=e=>T(e,E),lr=e=>e.reduce((t,r)=>{if(r.code===117){const a=r.parameters[0];t[a]=(t[a]||0)+1}return t},{});c.audioPathFromCommands=D,c.collectAudioCommands=h,c.collectImageCommands=g,c.collectVariableReadCommand=E,c.commandChoice=H,c.correctMapEventText=Ye,c.expectAudioFromTroop=_e,c.extractAudioCFromCommonEvents=Re,c.extractAudioFromMap=G,c.extractAudioFromMapFileInfo=ke,c.extractCommonEventCalls=lr,c.extractImageFromActor=Xe,c.extractImageFromEnemy=Qe,c.extractImageFromSystem=Ue,c.extractImagesFromCommandList=Y,c.extractImagesFromCommonEvents=er,c.extractImagesFromTroop=$e,c.extractNoteText=y,c.extractPageCondition=U,c.extractTextData=s,c.extractTextFromActor=Le,c.extractTextFromArmor=He,c.extractTextFromClass=Ge,c.extractTextFromCommonEvent=Ke,c.extractTextFromEnemy=De,c.extractTextFromEventCommands=A,c.extractTextFromEventPages=B,c.extractTextFromItem=ze,c.extractTextFromMap=rr,c.extractTextFromSkill=Oe,c.extractTextFromState=Je,c.extractTextFromTroop=qe,c.extractTextFromWeapon=je,c.extractTextMapper=z,c.extractVariableInfos=q,c.extractVariableReadingFromCommonEvent=dr,c.extractVariableReadingFromMap=ir,c.extractVariableReadingFromTroop=ur,c.extractVariableReference=K,c.extractVariableWritsFromControlVariable=X,c.extractVariableWritsFromEventCommand=mr,c.isAudioResource=Se,c.isVariableReadCommand=Q,c.isVariableWriteCommand=sr,c.readScript=j,c.systemAudioFiles=We,Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=rpg-analyzer.umd.js.map
