(function(n,i){typeof exports=="object"&&typeof module<"u"?i(exports):typeof define=="function"&&define.amd?define(["exports"],i):(n=typeof globalThis<"u"?globalThis:n||self,i(n.RpgAnalyzer={}))})(this,function(n){"use strict";const g="bgm",C="se",m="me",b="bgs",x=(e,r)=>r?e===r.code:!1,G="MessageHeader invalid command",L="Invalid Head",w=e=>typeof e[0]=="string"&&e.length===1,u=(e,r,t)=>{const o=[];for(let s=t;s<r.length;s++){const l=r[s];if(x(e,l)&&w(l.parameters))o.push({code:e,indent:l.indent,parameters:[l.parameters[0]]});else break}return o},B=(e,r,t)=>{const o=e[r];if(o&&x(t,o)&&w(o.parameters))return{code:t,indent:o.indent,parameters:[o.parameters[0]]};throw new Error(L,{cause:o})},_=(e,r)=>({head:B(e,r,108),bodys:u(408,e,r+1)}),R=(e,r)=>({head:B(e,r,355),bodys:u(655,e,r+1)}),W=(e,r)=>{const t=e[r];if(t&&J(t))return t;throw new Error(G,{cause:t})},J=e=>!e||e.code!==101||![4,5].includes(e.parameters.length)?!1:typeof e.parameters[0]=="string"&&typeof e.parameters[1]=="number"&&typeof e.parameters[2]=="number"&&typeof e.parameters[3]=="number",j=(e,r)=>({head:W(e,r),bodys:u(401,e,r+1)}),H="ScrollTextHeader invalid command",Q=(e,r)=>{const t=e[r];if(x(105,t))return t;const o={headCode:105,bodyCode:405,index:r};throw new Error(H,{cause:o})},V=(e,r)=>({head:Q(e,r),bodys:u(405,e,r+1)}),O=(e,r=`
`)=>e.map(t=>t.parameters[0]).join(r);class A{constructor(r,t){this.header=r,this.bodies=t}getBodyText(r=`
`){return O(this.getExpandedBodies(),r)}jopinHedderAndBody(){return[this.header,...this.bodies]}joinCommandBodies(){return this.getExpandedBodies()}}class E extends A{constructor(r,t,o){super(t,o),this.bodyCode=r}getExpandedBodies(){return this.bodies}normalizedCommands(){const r={...this.header,code:this.header.code,indent:this.header.indent,parameters:[...this.header.parameters]};return this.bodies.length===0?[r]:[r,this.mergedBody()]}mergedBody(){return{code:this.bodyCode,indent:this.header.indent,parameters:[this.getBodyText()]}}}class v extends A{getExpandedBodies(){return[this.header,...this.bodies]}mergedBody(){return{code:this.header.code,indent:this.header.indent,parameters:[this.getBodyText()]}}normalizedCommands(){return[this.mergedBody()]}}const Z="選択肢ヘルプ",U=e=>e.parameters[0]===Z,K=(e,r=[])=>new E(401,e,r),Y=(e,r=[])=>new E(405,e,r),q=(e,r=[])=>U(e)?new E(408,e,r):new v(e,r),X=(e,r=[])=>new v(e,r),$=(e,r,t)=>{const o=j(e,r),s=K(o.head,o.bodys);return t(s)},ee=(e,r,t)=>{const o=V(e,r),s=Y(o.head,o.bodys);return t(s)},re=(e,r,t)=>{const o=_(e,r),s=q(o.head,o.bodys);return t(s)},te=(e,r,t)=>{const o=R(e,r),s=X(o.head,o.bodys);return t(s)},a=(e,r,t,o,s)=>o?o(e,r,t):s(e,r,t),S=(e,r)=>e.map((t,o)=>oe(e,o,r)),oe=(e,r,t)=>{const o=e[r];switch(o.code){case 101:return t.showMessage?$(e,r,t.showMessage):t.other(o,r,e);case 401:return a(o,r,e,t.showMessageBody,t.other);case 105:return t.showScrollingText?ee(e,r,t.showScrollingText):t.other(o,r,e);case 405:return a(o,r,e,t.showScrollingTextBody,t.other);case 108:return t.comment?re(e,r,t.comment):t.other(o,r,e);case 408:return a(o,r,e,t.commentBody,t.other);case 355:return t.script?te(e,r,t.script):t.other(o,r,e);case 655:return a(o,r,e,t.scriptBody,t.other);case 121:return a(o,r,e,t.controlSwitch,t.other);case 122:return a(o,r,e,t.controlVariable,t.other);case 123:return a(o,r,e,t.controlSelfSwitch,t.other);case 124:return a(o,r,e,t.controlTimer,t.other);case 111:return a(o,r,e,t.conditionalBranch,t.other);case 102:return a(o,r,e,t.showChoices,t.other);case 402:return a(o,r,e,t.choiceWhen,t.other);case 320:return a(o,r,e,t.changeName,t.other);case 325:return a(o,r,e,t.changeProfile,t.other);case 324:return a(o,r,e,t.changeNickname,t.other);case 117:return a(o,r,e,t.commonEvent,t.other);case 118:return a(o,r,e,t.label,t.other);case 119:return a(o,r,e,t.labelJump,t.other);case 132:return a(o,r,e,t.changeBattleBGM,t.other);case 133:return a(o,r,e,t.changeVictoryME,t.other);case 139:return a(o,r,e,t.changeDefeatME,t.other);case 134:return a(o,r,e,t.changeSaveAccess,t.other);case 135:return a(o,r,e,t.changeMenuAccess,t.other);case 136:return a(o,r,e,t.changeEncounter,t.other);case 137:return a(o,r,e,t.changeFormationAccess,t.other);case 138:return a(o,r,e,t.changeWindowColor,t.other);case 223:return a(o,r,e,t.tintScreen,t.other);case 224:return a(o,r,e,t.flashScreen,t.other);case 225:return a(o,r,e,t.shakeScreen,t.other);case 301:return a(o,r,e,t.battleProcessing,t.other);case 230:return a(o,r,e,t.wait,t.other);case 322:return a(o,r,e,t.changeActorImages,t.other);case 125:return a(o,r,e,t.changeGold,t.other);case 212:return a(o,r,e,t.showAnimation,t.other);case 201:return a(o,r,e,t.transferPlayer,t.other);case 202:return a(o,r,e,t.setVehicleLocation,t.other);case 203:return a(o,r,e,t.setEventLocation,t.other);case 353:return a(o,r,e,t.gameover,t.other)}return t.other(o,r,e)},ae={commentBody:()=>[],showMessageBody:()=>[],scriptBody:()=>[],showScrollingTextBody:()=>[],showMessage:e=>e.normalizedCommands(),showScrollingText:e=>e.normalizedCommands(),comment:e=>e.normalizedCommands(),script:e=>e.normalizedCommands(),other:e=>[e]},ne=e=>S(e,ae),se=e=>!!e,p=(e,r)=>e.pages.map((t,o)=>r(t,o,e)),ce=(e,r)=>e.events.filter(se).map(t=>p(t,r)),de=(e,r)=>ce(e,r).flat(2),me=(e,r)=>e.map(t=>p(t,r)),ie=(e,r)=>e.map((t,o)=>r(t,o,t)),ue=()=>/<([^<>:]+):([^>]*)>/g,he=(e,r)=>{const t=ue(),o=[];let s;for(;(s=t.exec(e))!==null;)o.push(r(s[1],s[2]));return o},le=(e,r,t)=>r.map(o=>t(o,e[o],e)),ge=(e,r,t)=>le(e,r,t),d=(e,r)=>({code:e.code,paramIndex:r,value:e.parameters[r]}),xe=e=>e.folder===C||e.folder===g||e.folder===b||e.folder===m,Ee=[241,245,249,250,132,133,139,140],M=e=>Ee.includes(e.code),I=e=>({folder:pe(e)||"",fileName:e.parameters[0].name}),pe=e=>fe[e.code],fe={241:g,245:b,249:m,250:C,132:g,133:m,139:m,140:m},h=(e,r,t)=>e.list.filter(M).map(o=>({code:o.code,path:I(o),pageIndex:r,eventId:t.id})),Te=e=>ie(e,h).flat(2),ye=e=>me(e,h).flat(2),N=e=>({bgm:e.bgm,bgs:e.bgs,commands:de(e,h)}),Fe=e=>({map:N(e.map),filename:e.filename,editingName:e.editingName}),Ce=e=>({sounds:f(e.sounds),bgm:f([e.battleBgm,e.titleBgm]),me:f([e.defeatMe,e.gameoverMe,e.victoryMe])}),f=e=>e.map((r,t)=>({index:t,path:r.name})),k=(e,r,t)=>({key:e,text:r,id:t.id}),c=(e,r)=>({main:ge(e,r,(t,o)=>k(t,o,e)),note:T(e)}),T=e=>he(e.note,(r,t)=>k(r,t,e)),be=e=>c(e,["name","nickname","profile"]),we=e=>c(e,["name"]),Be=e=>c(e,["name"]),Ae=e=>c(e,["name","description","message1","message2"]),ve=e=>c(e,["name","description"]),Se=e=>c(e,["name","description"]),Me=e=>c(e,["name","description"]),Ie=e=>c(e,["name","message1","message2","message3","message4"]),y=e=>{const r=ne(e).flat();return S(r,P)},F=e=>p(e,r=>y(r.list)),P={changeName:e=>[d(e,1)],changeNickname:e=>[d(e,1)],changeProfile:e=>[d(e,1)],showChoices:e=>D(e),showScrollingText:e=>[d(e.mergedBody(),0)],showMessage:e=>{const r=e.normalizedCommands(),t=d(r[0],4),o=r[1];return o?[t,d(o,0)]:[t]},choiceWhen(){return[]},comment(e){const r=e.mergedBody();return[d(r,0)]},script:e=>z(),other:()=>[],commentBody:()=>[]},z=e=>[],D=e=>e.parameters[0].map((r,t)=>({code:e.code,paramIndex:t,value:r})),Ne=e=>{const r=F(e);return{note:T(e),eventId:e.id,commands:r.flat(2)}},ke=e=>{const r=F(e);return{troopId:e.id,commands:r.flat(2)}},Pe=e=>({eventId:e.id,commands:y(e.list).flat(2)});n.audioPathFromCommands=I,n.collectAudioCommands=h,n.commandChoice=D,n.correctMapEventText=Ne,n.expectAudioFromTroop=ye,n.extractAudioCFromCommonEvents=Te,n.extractAudioFromMap=N,n.extractAudioFromMapFileInfo=Fe,n.extractNoteText=T,n.extractTextData=c,n.extractTextFromActor=be,n.extractTextFromArmor=Me,n.extractTextFromClass=Be,n.extractTextFromCommonEvent=Pe,n.extractTextFromEnemy=we,n.extractTextFromEventCommands=y,n.extractTextFromEventPages=F,n.extractTextFromItem=ve,n.extractTextFromSkill=Ae,n.extractTextFromState=Ie,n.extractTextFromTroop=ke,n.extractTextFromWeapon=Se,n.extractTextMapper=P,n.isAudioCommand=M,n.isAudioResource=xe,n.readScript=z,n.systemAudioFiles=Ce,Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=rpg-analyzer.umd.js.map
