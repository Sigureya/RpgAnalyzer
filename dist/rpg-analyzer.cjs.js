"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const P=101,k=401,te=102,oe=402,x=105,E=405,D=108,_=408,ae=111,ce=117,se=118,ne=119,me=121,de=122,ie=123,he=124,ue=125,T=132,f=133,le=134,ge=135,xe=136,pe=137,Ee=138,F=139,z=140,Te=201,fe=202,Fe=203,ye=211,be=212,Ce=223,Be=224,we=225,Ie=230,Ae=231,Se=232,ve=233,Me=234,Ne=235,Pe=236,y=241,ke=242,W=245,b=249,C=250,De=251,_e=261,ze=283,We=284,Ge=301,Le=320,Ve=322,He=323,Oe=324,Re=325,je=353,G=355,L=655,p="bgm",V="se",d="me",H="bgs",B=(e,t)=>t?e===t.code:!1,Je="MessageHeader invalid command",Qe="Invalid Head",O=e=>typeof e[0]=="string"&&e.length===1,h=(e,t,r)=>{const o=[];for(let c=r;c<t.length;c++){const i=t[c];if(B(e,i)&&O(i.parameters))o.push({code:e,indent:i.indent,parameters:[i.parameters[0]]});else break}return o},R=(e,t,r)=>{const o=e[t];if(o&&B(r,o)&&O(o.parameters))return{code:r,indent:o.indent,parameters:[o.parameters[0]]};throw new Error(Qe,{cause:o})},Ze=(e,t)=>({head:R(e,t,D),bodys:h(_,e,t+1)}),qe=(e,t)=>({head:R(e,t,G),bodys:h(L,e,t+1)}),Ke=(e,t)=>{const r=e[t];if(r&&Ue(r))return r;throw new Error(Je,{cause:r})},Ue=e=>!e||e.code!==P||![4,5].includes(e.parameters.length)?!1:typeof e.parameters[0]=="string"&&typeof e.parameters[1]=="number"&&typeof e.parameters[2]=="number"&&typeof e.parameters[3]=="number",Ye=(e,t)=>({head:Ke(e,t),bodys:h(k,e,t+1)}),Xe="ScrollTextHeader invalid command",$e=(e,t)=>{const r=e[t];if(B(x,r))return r;const o={headCode:x,bodyCode:E,index:t};throw new Error(Xe,{cause:o})},er=(e,t)=>({head:$e(e,t),bodys:h(E,e,t+1)}),rr=(e,t=`
`)=>e.map(r=>r.parameters[0]).join(t);class j{constructor(t,r){this.header=t,this.bodies=r}getBodyText(t=`
`){return rr(this.getExpandedBodies(),t)}jopinHedderAndBody(){return[this.header,...this.bodies]}joinCommandBodies(){return this.getExpandedBodies()}}class w extends j{constructor(t,r,o){super(r,o),this.bodyCode=t}getExpandedBodies(){return this.bodies}normalizedCommands(){const t={...this.header,code:this.header.code,indent:this.header.indent,parameters:[...this.header.parameters]};return this.bodies.length===0?[t]:[t,this.mergedBody()]}mergedBody(){return{code:this.bodyCode,indent:this.header.indent,parameters:[this.getBodyText()]}}}class J extends j{getExpandedBodies(){return[this.header,...this.bodies]}mergedBody(){return{code:this.header.code,indent:this.header.indent,parameters:[this.getBodyText()]}}normalizedCommands(){return[this.mergedBody()]}}const tr="選択肢ヘルプ",or=e=>e.parameters[0]===tr,ar=(e,t=[])=>new w(401,e,t),cr=(e,t=[])=>new w(405,e,t),sr=(e,t=[])=>or(e)?new w(408,e,t):new J(e,t),nr=(e,t=[])=>new J(e,t),mr=(e,t,r)=>{const o=Ye(e,t),c=ar(o.head,o.bodys);return r(c)},dr=(e,t,r)=>{const o=er(e,t),c=cr(o.head,o.bodys);return r(c)},ir=(e,t,r)=>{const o=Ze(e,t),c=sr(o.head,o.bodys);return r(c)},hr=(e,t,r)=>{const o=qe(e,t),c=nr(o.head,o.bodys);return r(c)},a=(e,t,r,o,c)=>o?o(e,t,r):c(e,t,r),I=(e,t)=>e.map((r,o)=>ur(e,o,t)),ur=(e,t,r)=>{const o=e[t];switch(o.code){case P:return r.showMessage?mr(e,t,r.showMessage):r.other(o,t,e);case k:return a(o,t,e,r.showMessageBody,r.other);case x:return r.showScrollingText?dr(e,t,r.showScrollingText):r.other(o,t,e);case E:return a(o,t,e,r.showScrollingTextBody,r.other);case te:return a(o,t,e,r.showChoices,r.other);case oe:return a(o,t,e,r.choiceWhen,r.other);case D:return r.comment?ir(e,t,r.comment):r.other(o,t,e);case _:return a(o,t,e,r.commentBody,r.other);case G:return r.script?hr(e,t,r.script):r.other(o,t,e);case L:return a(o,t,e,r.scriptBody,r.other);case ae:return a(o,t,e,r.conditionalBranch,r.other);case me:return a(o,t,e,r.controlSwitch,r.other);case de:return a(o,t,e,r.controlVariable,r.other);case ie:return a(o,t,e,r.controlSelfSwitch,r.other);case he:return a(o,t,e,r.controlTimer,r.other);case ce:return a(o,t,e,r.commonEvent,r.other);case le:return a(o,t,e,r.changeSaveAccess,r.other);case ge:return a(o,t,e,r.changeMenuAccess,r.other);case xe:return a(o,t,e,r.changeEncounter,r.other);case pe:return a(o,t,e,r.changeFormationAccess,r.other);case Le:return a(o,t,e,r.changeName,r.other);case Re:return a(o,t,e,r.changeProfile,r.other);case Oe:return a(o,t,e,r.changeNickname,r.other);case Ve:return a(o,t,e,r.changeActorImages,r.other);case He:return a(o,t,e,r.changeVehicleImage,r.other);case T:return a(o,t,e,r.changeBattleBGM,r.other);case f:return a(o,t,e,r.changeVictoryME,r.other);case F:return a(o,t,e,r.changeDefeatME,r.other);case y:return a(o,t,e,r.playBGM,r.other);case ke:return a(o,t,e,r.fadeOutBGM,r.other);case C:return a(o,t,e,r.playSE,r.other);case De:return a(o,t,e,r.stopSE,r.other);case b:return a(o,t,e,r.playME,r.other);case se:return a(o,t,e,r.label,r.other);case ne:return a(o,t,e,r.labelJump,r.other);case Ee:return a(o,t,e,r.changeWindowColor,r.other);case Ce:return a(o,t,e,r.tintScreen,r.other);case Be:return a(o,t,e,r.flashScreen,r.other);case we:return a(o,t,e,r.shakeScreen,r.other);case Ae:return a(o,t,e,r.showPicture,r.other);case Se:return a(o,t,e,r.movePicture,r.other);case ve:return a(o,t,e,r.rotatePicture,r.other);case Me:return a(o,t,e,r.tintPicture,r.other);case Ne:return a(o,t,e,r.erasePicture,r.other);case Ge:return a(o,t,e,r.battleProcessing,r.other);case Ie:return a(o,t,e,r.wait,r.other);case je:return a(o,t,e,r.gameover,r.other);case We:return a(o,t,e,r.changeParallax,r.other);case ze:return a(o,t,e,r.changeBattleBackground,r.other);case _e:return a(o,t,e,r.playMovie,r.other);case ye:return a(o,t,e,r.changeTransparency,r.other);case Pe:return a(o,t,e,r.setWeatherEffects,r.other);case ue:return a(o,t,e,r.changeGold,r.other);case be:return a(o,t,e,r.showAnimation,r.other);case Te:return a(o,t,e,r.transferPlayer,r.other);case fe:return a(o,t,e,r.setVehicleLocation,r.other);case Fe:return a(o,t,e,r.setEventLocation,r.other);default:return r.other(o,t,e)}},lr={commentBody:()=>[],showMessageBody:()=>[],scriptBody:()=>[],showScrollingTextBody:()=>[],showMessage:e=>e.normalizedCommands(),showScrollingText:e=>e.normalizedCommands(),comment:e=>e.normalizedCommands(),script:e=>e.normalizedCommands(),other:e=>[e]},gr=e=>I(e,lr),xr=e=>!!e,A=(e,t)=>e.pages.map((r,o)=>t(r,o,e)),pr=(e,t)=>e.events.filter(xr).map(r=>A(r,t)),Er=(e,t)=>pr(e,t).flat(2),Tr=(e,t)=>e.map(r=>A(r,t)),fr=(e,t)=>e.map((r,o)=>t(r,o,r)),Fr=()=>/<([^<>:]+):([^>]*)>/g,yr=(e,t)=>{const r=Fr(),o=[];let c;for(;(c=r.exec(e))!==null;)o.push(t(c[1],c[2]));return o},br=(e,t,r)=>t.map(o=>r(o,e[o],e)),Q=(e,t,r)=>br(e,t,r),m=(e,t)=>({code:e.code,paramIndex:t,value:e.parameters[t]}),Cr=e=>e.folder===V||e.folder===p||e.folder===H||e.folder===d,Br=[y,W,b,C,T,f,F,z],Z=e=>Br.includes(e.code),q=e=>({folder:wr(e)||"",fileName:e.parameters[0].name}),wr=e=>Ir[e.code],Ir={[y]:p,[W]:H,[b]:d,[C]:V,[T]:p,[f]:d,[F]:d,[z]:d},u=(e,t,r)=>e.list.filter(Z).map(o=>({code:o.code,path:q(o),pageIndex:t,eventId:r.id})),Ar=e=>fr(e,u).flat(2),Sr=e=>Tr(e,u).flat(2),K=e=>({bgm:e.bgm,bgs:e.bgs,commands:Er(e,u)}),vr=e=>({map:K(e.map),filename:e.filename,editingName:e.editingName}),Mr=e=>({sounds:l(e.sounds),bgm:l([e.battleBgm,e.titleBgm]),me:l([e.defeatMe,e.gameoverMe,e.victoryMe])}),l=e=>e.map((t,r)=>({index:r,path:t.name})),U=(e,t,r)=>({key:e,text:t,id:r.id}),s=(e,t)=>({main:Q(e,t,(r,o)=>U(r,o,e)),note:S(e)}),S=e=>yr(e.note,(t,r)=>U(t,r,e)),Nr=e=>s(e,["name","nickname","profile"]),Pr=e=>s(e,["name"]),kr=e=>s(e,["name"]),Dr=e=>s(e,["name","description","message1","message2"]),_r=e=>s(e,["name","description"]),zr=e=>s(e,["name","description"]),Wr=e=>s(e,["name","description"]),Gr=e=>s(e,["name","message1","message2","message3","message4"]),v=e=>{const t=gr(e).flat();return I(t,Y)},M=e=>A(e,t=>v(t.list)),Y={changeName:e=>[m(e,1)],changeNickname:e=>[m(e,1)],changeProfile:e=>[m(e,1)],showChoices:e=>$(e),showScrollingText:e=>[m(e.mergedBody(),0)],showMessage:e=>{const t=e.normalizedCommands(),r=m(t[0],4),o=t[1];return o?[r,m(o,0)]:[r]},choiceWhen(){return[]},comment(e){const t=e.mergedBody();return[m(t,0)]},script:e=>X(),other:()=>[],commentBody:()=>[]},X=e=>[],$=e=>e.parameters[0].map((t,r)=>({code:e.code,paramIndex:r,value:t})),Lr=e=>{const t=M(e);return{note:S(e),eventId:e.id,commands:t.flat(2)}},Vr=e=>{const t=M(e);return{troopId:e.id,commands:t.flat(2)}},Hr=e=>({eventId:e.id,commands:v(e.list).flat(2)}),Or=e=>I(e,Rr),n=(e,t,r)=>({folderName:r,command:m(e,t)}),Rr={changeActorImages:e=>[n(e,1,"characters"),n(e,3,"faces"),n(e,5,"sv_actors")],showPicture:e=>[n(e,1,"pictures")],changeBattleBackground:e=>[n(e,0,"battlebacks1"),n(e,1,"battlebacks2")],changeParallax:e=>[n(e,0,"parallaxes")],changeVehicleImage:e=>[n(e,1,"characters")],other:()=>[]},jr=e=>({key:"battlerName",image:e.battlerName,id:e.id}),ee=(e,t,r)=>({key:e,image:t,id:r.id}),re=(e,t)=>Q(e,t,(r,o)=>ee(r,o,e)),Jr=e=>re(e,["characterName","faceName","battlerName"]),g=(e,t)=>({folder:"characters",key:t,image:e[t].characterName}),N=(e,t,r)=>({folder:r,key:t,image:e[t]}),Qr=e=>[N(e,"title1Name","titles1"),N(e,"title2Name","titles2"),g(e,"boat"),g(e,"ship"),g(e,"airship")];exports.audioPathFromCommands=q;exports.collectAudioCommands=u;exports.commandChoice=$;exports.correctMapEventText=Lr;exports.expectAudioFromTroop=Sr;exports.extractAudioCFromCommonEvents=Ar;exports.extractAudioFromMap=K;exports.extractAudioFromMapFileInfo=vr;exports.extractImageData=re;exports.extractImageFromActor=Jr;exports.extractImageFromEnemy=jr;exports.extractImageFromSystem=Qr;exports.extractImagesFromCommands=Or;exports.extractNoteText=S;exports.extractTextData=s;exports.extractTextFromActor=Nr;exports.extractTextFromArmor=Wr;exports.extractTextFromClass=kr;exports.extractTextFromCommonEvent=Hr;exports.extractTextFromEnemy=Pr;exports.extractTextFromEventCommands=v;exports.extractTextFromEventPages=M;exports.extractTextFromItem=_r;exports.extractTextFromSkill=Dr;exports.extractTextFromState=Gr;exports.extractTextFromTroop=Vr;exports.extractTextFromWeapon=zr;exports.extractTextMapper=Y;exports.extractedImageItem=ee;exports.isAudioCommand=Z;exports.isAudioResource=Cr;exports.readScript=X;exports.systemAudioFiles=Mr;
//# sourceMappingURL=rpg-analyzer.cjs.js.map
