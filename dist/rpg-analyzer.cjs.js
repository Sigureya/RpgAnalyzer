"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const L=101,_=401,ie=102,ue=402,f=105,T=405,z=108,W=408,he=111,le=117,ge=118,xe=119,pe=121,fe=122,Ee=123,Te=124,be=125,b=132,F=133,Fe=134,ye=135,Ce=136,Be=137,Ie=138,y=139,D=140,we=201,ve=202,Ae=203,Ne=211,Me=212,Se=223,Pe=224,ke=225,Le=230,G=231,_e=232,ze=233,We=234,De=235,Ge=236,C=241,Ve=242,V=245,B=249,I=250,He=251,Re=261,H=283,R=284,je=301,Oe=320,j=322,O=323,Je=324,Qe=325,qe=353,J=355,Q=655,E="bgm",q="se",d="me",K="bgs",w=(e,t)=>t?e===t.code:!1,Ke="MessageHeader invalid command",Ue="Invalid Head",U=e=>typeof e[0]=="string"&&e.length===1,u=(e,t,r)=>{const a=[];for(let c=r;c<t.length;c++){const i=t[c];if(w(e,i)&&U(i.parameters))a.push({code:e,indent:i.indent,parameters:[i.parameters[0]]});else break}return a},Y=(e,t,r)=>{const a=e[t];if(a&&w(r,a)&&U(a.parameters))return{code:r,indent:a.indent,parameters:[a.parameters[0]]};throw new Error(Ue,{cause:a})},Ye=(e,t)=>({head:Y(e,t,z),bodys:u(W,e,t+1)}),Ze=(e,t)=>({head:Y(e,t,J),bodys:u(Q,e,t+1)}),Xe=(e,t)=>{const r=e[t];if(r&&$e(r))return r;throw new Error(Ke,{cause:r})},$e=e=>!e||e.code!==L||![4,5].includes(e.parameters.length)?!1:typeof e.parameters[0]=="string"&&typeof e.parameters[1]=="number"&&typeof e.parameters[2]=="number"&&typeof e.parameters[3]=="number",er=(e,t)=>({head:Xe(e,t),bodys:u(_,e,t+1)}),rr="ScrollTextHeader invalid command",tr=(e,t)=>{const r=e[t];if(w(f,r))return r;const a={headCode:f,bodyCode:T,index:t};throw new Error(rr,{cause:a})},ar=(e,t)=>({head:tr(e,t),bodys:u(T,e,t+1)}),or=(e,t=`
`)=>e.map(r=>r.parameters[0]).join(t);class Z{constructor(t,r){this.header=t,this.bodies=r}getBodyText(t=`
`){return or(this.getExpandedBodies(),t)}jopinHedderAndBody(){return[this.header,...this.bodies]}joinCommandBodies(){return this.getExpandedBodies()}}class v extends Z{constructor(t,r,a){super(r,a),this.bodyCode=t}getExpandedBodies(){return this.bodies}normalizedCommands(){const t={...this.header,code:this.header.code,indent:this.header.indent,parameters:[...this.header.parameters]};return this.bodies.length===0?[t]:[t,this.mergedBody()]}mergedBody(){return{code:this.bodyCode,indent:this.header.indent,parameters:[this.getBodyText()]}}}class X extends Z{getExpandedBodies(){return[this.header,...this.bodies]}mergedBody(){return{code:this.header.code,indent:this.header.indent,parameters:[this.getBodyText()]}}normalizedCommands(){return[this.mergedBody()]}}const cr="選択肢ヘルプ",sr=e=>e.parameters[0]===cr,nr=(e,t=[])=>new v(401,e,t),mr=(e,t=[])=>new v(405,e,t),dr=(e,t=[])=>sr(e)?new v(408,e,t):new X(e,t),ir=(e,t=[])=>new X(e,t),ur=(e,t,r)=>{const a=er(e,t),c=nr(a.head,a.bodys);return r(c)},hr=(e,t,r)=>{const a=ar(e,t),c=mr(a.head,a.bodys);return r(c)},lr=(e,t,r)=>{const a=Ye(e,t),c=dr(a.head,a.bodys);return r(c)},gr=(e,t,r)=>{const a=Ze(e,t),c=ir(a.head,a.bodys);return r(c)},o=(e,t,r,a,c)=>a?a(e,t,r):c(e,t,r),A=(e,t)=>e.map((r,a)=>xr(e,a,t)),xr=(e,t,r)=>{const a=e[t];switch(a.code){case L:return r.showMessage?ur(e,t,r.showMessage):r.other(a,t,e);case _:return o(a,t,e,r.showMessageBody,r.other);case f:return r.showScrollingText?hr(e,t,r.showScrollingText):r.other(a,t,e);case T:return o(a,t,e,r.showScrollingTextBody,r.other);case ie:return o(a,t,e,r.showChoices,r.other);case ue:return o(a,t,e,r.choiceWhen,r.other);case z:return r.comment?lr(e,t,r.comment):r.other(a,t,e);case W:return o(a,t,e,r.commentBody,r.other);case J:return r.script?gr(e,t,r.script):r.other(a,t,e);case Q:return o(a,t,e,r.scriptBody,r.other);case he:return o(a,t,e,r.conditionalBranch,r.other);case pe:return o(a,t,e,r.controlSwitch,r.other);case fe:return o(a,t,e,r.controlVariable,r.other);case Ee:return o(a,t,e,r.controlSelfSwitch,r.other);case Te:return o(a,t,e,r.controlTimer,r.other);case le:return o(a,t,e,r.commonEvent,r.other);case Fe:return o(a,t,e,r.changeSaveAccess,r.other);case ye:return o(a,t,e,r.changeMenuAccess,r.other);case Ce:return o(a,t,e,r.changeEncounter,r.other);case Be:return o(a,t,e,r.changeFormationAccess,r.other);case Oe:return o(a,t,e,r.changeName,r.other);case Qe:return o(a,t,e,r.changeProfile,r.other);case Je:return o(a,t,e,r.changeNickname,r.other);case j:return o(a,t,e,r.changeActorImages,r.other);case O:return o(a,t,e,r.changeVehicleImage,r.other);case b:return o(a,t,e,r.changeBattleBGM,r.other);case F:return o(a,t,e,r.changeVictoryME,r.other);case y:return o(a,t,e,r.changeDefeatME,r.other);case C:return o(a,t,e,r.playBGM,r.other);case Ve:return o(a,t,e,r.fadeOutBGM,r.other);case I:return o(a,t,e,r.playSE,r.other);case He:return o(a,t,e,r.stopSE,r.other);case B:return o(a,t,e,r.playME,r.other);case ge:return o(a,t,e,r.label,r.other);case xe:return o(a,t,e,r.labelJump,r.other);case Ie:return o(a,t,e,r.changeWindowColor,r.other);case Se:return o(a,t,e,r.tintScreen,r.other);case Pe:return o(a,t,e,r.flashScreen,r.other);case ke:return o(a,t,e,r.shakeScreen,r.other);case G:return o(a,t,e,r.showPicture,r.other);case _e:return o(a,t,e,r.movePicture,r.other);case ze:return o(a,t,e,r.rotatePicture,r.other);case We:return o(a,t,e,r.tintPicture,r.other);case De:return o(a,t,e,r.erasePicture,r.other);case je:return o(a,t,e,r.battleProcessing,r.other);case Le:return o(a,t,e,r.wait,r.other);case qe:return o(a,t,e,r.gameover,r.other);case R:return o(a,t,e,r.changeParallax,r.other);case H:return o(a,t,e,r.changeBattleBackground,r.other);case Re:return o(a,t,e,r.playMovie,r.other);case Ne:return o(a,t,e,r.changeTransparency,r.other);case Ge:return o(a,t,e,r.setWeatherEffects,r.other);case be:return o(a,t,e,r.changeGold,r.other);case Me:return o(a,t,e,r.showAnimation,r.other);case we:return o(a,t,e,r.transferPlayer,r.other);case ve:return o(a,t,e,r.setVehicleLocation,r.other);case Ae:return o(a,t,e,r.setEventLocation,r.other);default:return r.other(a,t,e)}},pr={commentBody:()=>[],showMessageBody:()=>[],scriptBody:()=>[],showScrollingTextBody:()=>[],showMessage:e=>e.normalizedCommands(),showScrollingText:e=>e.normalizedCommands(),comment:e=>e.normalizedCommands(),script:e=>e.normalizedCommands(),other:e=>[e]},fr=e=>A(e,pr),Er=e=>!!e,N=(e,t)=>e.pages.map((r,a)=>t(r,a,e)),Tr=(e,t)=>e.events.filter(Er).map(r=>N(r,t)),$=(e,t)=>Tr(e,t).flat(2),ee=(e,t)=>e.map(r=>N(r,t)),re=(e,t)=>e.map((r,a)=>t(r,a,r)),br=()=>/<([^<>:]+):([^>]*)>/g,Fr=(e,t)=>{const r=br(),a=[];let c;for(;(c=r.exec(e))!==null;)a.push(t(c[1],c[2]));return a},yr=(e,t,r)=>t.map(a=>r(a,e[a],e)),Cr=(e,t,r)=>yr(e,t,r),m=(e,t)=>({code:e.code,paramIndex:t,value:e.parameters[t]}),te=(e,t)=>t.includes(e.code),Br=e=>te(e,Ir),Ir=[C,V,B,I,b,F,y,D],wr=e=>te(e,vr),vr=[G,j,O,R,H],Ar=e=>e.folder===q||e.folder===E||e.folder===K||e.folder===d,ae=e=>({folder:Nr(e)||"",fileName:e.parameters[0].name}),Nr=e=>Mr[e.code],Mr={[C]:E,[V]:K,[B]:d,[I]:q,[b]:E,[F]:d,[y]:d,[D]:d},h=(e,t,r)=>e.list.filter(Br).map(a=>({code:a.code,path:ae(a),pageIndex:t,eventId:r.id})),Sr=e=>re(e,h).flat(2),Pr=e=>ee(e,h).flat(2),oe=e=>({bgm:e.bgm,bgs:e.bgs,commands:$(e,h)}),kr=e=>({map:oe(e.map),filename:e.filename,editingName:e.editingName}),Lr=e=>({sounds:g(e.sounds),bgm:g([e.battleBgm,e.titleBgm]),me:g([e.defeatMe,e.gameoverMe,e.victoryMe])}),g=e=>e.map((t,r)=>({index:r,path:t.name})),ce=(e,t,r)=>({key:e,text:t,id:r.id}),s=(e,t)=>({main:Cr(e,t,(r,a)=>ce(r,a,e)),note:M(e)}),M=e=>Fr(e.note,(t,r)=>ce(t,r,e)),_r=e=>s(e,["name","nickname","profile"]),zr=e=>s(e,["name"]),Wr=e=>s(e,["name"]),Dr=e=>s(e,["name","description","message1","message2"]),Gr=e=>s(e,["name","description"]),Vr=e=>s(e,["name","description"]),Hr=e=>s(e,["name","description"]),Rr=e=>s(e,["name","message1","message2","message3","message4"]),S=e=>{const t=fr(e).flat();return A(t,se)},P=e=>N(e,t=>S(t.list)),se={changeName:e=>[m(e,1)],changeNickname:e=>[m(e,1)],changeProfile:e=>[m(e,1)],showChoices:e=>me(e),showScrollingText:e=>[m(e.mergedBody(),0)],showMessage:e=>{const t=e.normalizedCommands(),r=m(t[0],4),a=t[1];return a?[r,m(a,0)]:[r]},choiceWhen(){return[]},comment(e){const t=e.mergedBody();return[m(t,0)]},script:e=>ne(),other:()=>[],commentBody:()=>[]},ne=e=>[],me=e=>e.parameters[0].map((t,r)=>({code:e.code,paramIndex:r,value:t})),jr=e=>{const t=P(e);return{note:M(e),eventId:e.id,commands:t.flat(2)}},Or=e=>{const t=P(e);return{troopId:e.id,commands:t.flat(2)}},Jr=e=>({eventId:e.id,commands:S(e.list).flat(2)}),Qr=e=>({key:"battlerName",image:e.battlerName,id:e.id}),x=(e,t,r)=>({folder:r,key:t,image:e[t],id:e.id}),qr=e=>[x(e,"faceName","faces"),x(e,"characterName","characters"),x(e,"battlerName","sv_actors")],p=(e,t)=>({folder:"characters",key:t,image:e[t].characterName}),k=(e,t,r)=>({folder:r,key:t,image:e[t]}),Kr=e=>[k(e,"title1Name","titles1"),k(e,"title2Name","titles2"),p(e,"boat"),p(e,"ship"),p(e,"airship")],de=e=>A(e,Ur),n=(e,t,r)=>({folderName:r,command:m(e,t)}),Ur={changeActorImages:e=>[n(e,1,"characters"),n(e,3,"faces"),n(e,5,"sv_actors")],showPicture:e=>[n(e,1,"pictures")],changeBattleBackground:e=>[n(e,0,"battlebacks1"),n(e,1,"battlebacks2")],changeParallax:e=>[n(e,0,"parallaxes")],changeVehicleImage:e=>[n(e,1,"characters")],other:()=>[]},Yr=e=>ee(e,l).flat(2),Zr=e=>re(e,l).flat(2),Xr=e=>({commands:$(e,l),background1:{folderName:"battlebacks1",fileName:e.battleback1Name},background2:{folderName:"battlebacks2",fileName:e.battleback2Name},parallax:{folderName:"parallaxes",fileName:e.parallaxName}}),l=(e,t,r)=>de(e.list.filter(wr)).flatMap(c=>et(c,t,r)),$r=(e,t,r)=>({folderName:e.folderName,command:e.command,eventId:t.id,pageIndex:r,eventName:t.name}),et=(e,t,r)=>e.map(a=>$r(a,r,t));exports.audioPathFromCommands=ae;exports.collectAudioCommands=h;exports.collectImageCommands=l;exports.commandChoice=me;exports.correctMapEventText=jr;exports.expectAudioFromTroop=Pr;exports.extractAudioCFromCommonEvents=Sr;exports.extractAudioFromMap=oe;exports.extractAudioFromMapFileInfo=kr;exports.extractImageFromActor=qr;exports.extractImageFromEnemy=Qr;exports.extractImageFromSystem=Kr;exports.extractImagesFromCommandList=de;exports.extractImagesFromCommonEvents=Zr;exports.extractImagesFromTroop=Yr;exports.extractNoteText=M;exports.extractTextData=s;exports.extractTextFromActor=_r;exports.extractTextFromArmor=Hr;exports.extractTextFromClass=Wr;exports.extractTextFromCommonEvent=Jr;exports.extractTextFromEnemy=zr;exports.extractTextFromEventCommands=S;exports.extractTextFromEventPages=P;exports.extractTextFromItem=Gr;exports.extractTextFromMap=Xr;exports.extractTextFromSkill=Dr;exports.extractTextFromState=Rr;exports.extractTextFromTroop=Or;exports.extractTextFromWeapon=Vr;exports.extractTextMapper=se;exports.isAudioResource=Ar;exports.readScript=ne;exports.systemAudioFiles=Lr;
//# sourceMappingURL=rpg-analyzer.cjs.js.map
