"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const z=101,H=401,De=102,Oe=402,Ge=103,ze=104,E=105,I=405,j=108,J=408,He=111,Q=117,je=118,Je=119,Qe=121,u=122,Xe=123,Ye=124,qe=125,F=132,T=133,Ke=134,Ue=135,Ze=136,$e=137,er=138,v=139,X=140,y=201,A=202,rr=203,tr=211,ar=212,or=223,cr=224,sr=225,nr=230,Y=231,mr=232,ir=233,dr=234,lr=235,ur=236,N=241,hr=242,q=245,B=249,M=250,xr=251,gr=261,K=283,U=284,w=285,V=301,pr=320,Z=322,$=323,fr=324,br=325,ee=331,re=332,Er=353,te=355,ae=655,C="bgm",oe="se",i="me",ce="bgs",Cr="characters",S=(e,r)=>r?e===r.code:!1,Ir="MessageHeader invalid command",Fr="Invalid Head",se=e=>typeof e[0]=="string"&&e.length===1,h=(e,r,t)=>{const a=[];for(let c=t;c<r.length;c++){const l=r[c];if(S(e,l)&&se(l.parameters))a.push({code:e,indent:l.indent,parameters:[l.parameters[0]]});else break}return a},ne=(e,r,t)=>{const a=e[r];if(a&&S(t,a)&&se(a.parameters))return{code:t,indent:a.indent,parameters:[a.parameters[0]]};throw new Error(Fr,{cause:a})},Tr=(e,r)=>({head:ne(e,r,j),bodys:h(J,e,r+1)}),vr=(e,r)=>({head:ne(e,r,te),bodys:h(ae,e,r+1)}),yr=(e,r)=>{const t=e[r];if(t&&Ar(t))return t;throw new Error(Ir,{cause:t})},Ar=e=>!e||e.code!==z||![4,5].includes(e.parameters.length)?!1:typeof e.parameters[0]=="string"&&typeof e.parameters[1]=="number"&&typeof e.parameters[2]=="number"&&typeof e.parameters[3]=="number",Nr=(e,r)=>({head:yr(e,r),bodys:h(H,e,r+1)}),Br="ScrollTextHeader invalid command",Mr=(e,r)=>{const t=e[r];if(S(E,t))return t;const a={headCode:E,bodyCode:I,index:r};throw new Error(Br,{cause:a})},wr=(e,r)=>({head:Mr(e,r),bodys:h(I,e,r+1)}),Vr=(e,r=`
`)=>e.map(t=>t.parameters[0]).join(r);class me{constructor(r,t){this.header=r,this.bodies=t}getBodyText(r=`
`){return Vr(this.getExpandedBodies(),r)}jopinHedderAndBody(){return[this.header,...this.bodies]}joinCommandBodies(){return this.getExpandedBodies()}}class P extends me{constructor(r,t,a){super(t,a),this.bodyCode=r}getExpandedBodies(){return this.bodies}normalizedCommands(){const r={...this.header,code:this.header.code,indent:this.header.indent,parameters:[...this.header.parameters]};return this.bodies.length===0?[r]:[r,this.mergedBody()]}mergedBody(){return{code:this.bodyCode,indent:this.header.indent,parameters:[this.getBodyText()]}}}class ie extends me{getExpandedBodies(){return[this.header,...this.bodies]}mergedBody(){return{code:this.header.code,indent:this.header.indent,parameters:[this.getBodyText()]}}normalizedCommands(){return[this.mergedBody()]}}const Sr="選択肢ヘルプ",Pr=e=>e.parameters[0]===Sr,Rr=(e,r=[])=>new P(401,e,r),kr=(e,r=[])=>new P(405,e,r),Wr=(e,r=[])=>Pr(e)?new P(408,e,r):new ie(e,r),_r=(e,r=[])=>new ie(e,r),Lr=(e,r,t)=>{const a=Nr(e,r),c=Rr(a.head,a.bodys);return t(c)},Dr=(e,r,t)=>{const a=wr(e,r),c=kr(a.head,a.bodys);return t(c)},Or=(e,r,t)=>{const a=Tr(e,r),c=Wr(a.head,a.bodys);return t(c)},Gr=(e,r,t)=>{const a=vr(e,r),c=_r(a.head,a.bodys);return t(c)},o=(e,r,t,a,c)=>a?a(e,r,t):c(e,r,t),R=(e,r)=>e.map((t,a)=>de(e,a,r)),zr=(e,r)=>e.flatMap((t,a)=>de(e,a,r)),de=(e,r,t)=>{const a=e[r];switch(a.code){case z:return t.showMessage?Lr(e,r,t.showMessage):t.other(a,r,e);case H:return o(a,r,e,t.showMessageBody,t.other);case E:return t.showScrollingText?Dr(e,r,t.showScrollingText):t.other(a,r,e);case I:return o(a,r,e,t.showScrollingTextBody,t.other);case De:return o(a,r,e,t.showChoices,t.other);case Oe:return o(a,r,e,t.choiceWhen,t.other);case j:return t.comment?Or(e,r,t.comment):t.other(a,r,e);case J:return o(a,r,e,t.commentBody,t.other);case te:return t.script?Gr(e,r,t.script):t.other(a,r,e);case ae:return o(a,r,e,t.scriptBody,t.other);case He:return o(a,r,e,t.conditionalBranch,t.other);case Qe:return o(a,r,e,t.controlSwitch,t.other);case u:return o(a,r,e,t.controlVariable,t.other);case Xe:return o(a,r,e,t.controlSelfSwitch,t.other);case Ye:return o(a,r,e,t.controlTimer,t.other);case Q:return o(a,r,e,t.commonEvent,t.other);case Ke:return o(a,r,e,t.changeSaveAccess,t.other);case Ue:return o(a,r,e,t.changeMenuAccess,t.other);case Ze:return o(a,r,e,t.changeEncounter,t.other);case $e:return o(a,r,e,t.changeFormationAccess,t.other);case pr:return o(a,r,e,t.changeName,t.other);case br:return o(a,r,e,t.changeProfile,t.other);case fr:return o(a,r,e,t.changeNickname,t.other);case Z:return o(a,r,e,t.changeActorImages,t.other);case $:return o(a,r,e,t.changeVehicleImage,t.other);case F:return o(a,r,e,t.changeBattleBGM,t.other);case T:return o(a,r,e,t.changeVictoryME,t.other);case v:return o(a,r,e,t.changeDefeatME,t.other);case N:return o(a,r,e,t.playBGM,t.other);case hr:return o(a,r,e,t.fadeOutBGM,t.other);case M:return o(a,r,e,t.playSE,t.other);case xr:return o(a,r,e,t.stopSE,t.other);case B:return o(a,r,e,t.playME,t.other);case je:return o(a,r,e,t.label,t.other);case Je:return o(a,r,e,t.labelJump,t.other);case er:return o(a,r,e,t.changeWindowColor,t.other);case or:return o(a,r,e,t.tintScreen,t.other);case cr:return o(a,r,e,t.flashScreen,t.other);case sr:return o(a,r,e,t.shakeScreen,t.other);case Y:return o(a,r,e,t.showPicture,t.other);case mr:return o(a,r,e,t.movePicture,t.other);case ir:return o(a,r,e,t.rotatePicture,t.other);case dr:return o(a,r,e,t.tintPicture,t.other);case lr:return o(a,r,e,t.erasePicture,t.other);case V:return o(a,r,e,t.battleProcessing,t.other);case nr:return o(a,r,e,t.wait,t.other);case Er:return o(a,r,e,t.gameover,t.other);case U:return o(a,r,e,t.changeParallax,t.other);case K:return o(a,r,e,t.changeBattleBackground,t.other);case gr:return o(a,r,e,t.playMovie,t.other);case tr:return o(a,r,e,t.changeTransparency,t.other);case ur:return o(a,r,e,t.setWeatherEffects,t.other);case qe:return o(a,r,e,t.changeGold,t.other);case ar:return o(a,r,e,t.showAnimation,t.other);case y:return o(a,r,e,t.transferPlayer,t.other);case A:return o(a,r,e,t.setVehicleLocation,t.other);case rr:return o(a,r,e,t.setEventLocation,t.other);default:return t.other(a,r,e)}},Hr={commentBody:()=>[],showMessageBody:()=>[],scriptBody:()=>[],showScrollingTextBody:()=>[],showMessage:e=>e.normalizedCommands(),showScrollingText:e=>e.normalizedCommands(),comment:e=>e.normalizedCommands(),script:e=>e.normalizedCommands(),other:e=>[e]},jr=e=>R(e,Hr),Jr=e=>!!e,k=(e,r)=>e.pages.map((t,a)=>r(t,a,e)),le=(e,r)=>e.events.filter(Jr).map(t=>k(t,r)),ue=(e,r)=>le(e,r).flat(2),he=(e,r)=>e.map(t=>k(t,r)),xe=(e,r)=>e.map(t=>r(t,0,t)),ge=(e,r)=>r.includes(e.code),pe=e=>ge(e,Qr),Qr=[N,q,B,M,F,T,v,X],fe=e=>ge(e,Xr),Xr=[Y,Z,$,U,K],m=(e,r)=>({code:e.code,paramIndex:r,value:e.parameters[r]}),Yr=()=>/<([^<>:]+):([^>]*)>/g,qr=(e,r)=>{const t=Yr(),a=[];let c;for(;(c=t.exec(e))!==null;)a.push(r(c[1],c[2]));return a},Kr=(e,r,t)=>r.map(a=>t(a,e[a],e)),Ur=(e,r,t)=>Kr(e,r,t),Zr=e=>e.folder===oe||e.folder===C||e.folder===ce||e.folder===i,be=e=>({code:e.code,path:W(e)}),W=e=>({folder:$r(e)||"",fileName:e.parameters[0].name}),$r=e=>et[e.code],et={[N]:C,[q]:ce,[B]:i,[M]:oe,[F]:C,[T]:i,[v]:i,[X]:i},x=(e,r,t)=>e.list.filter(pe).map(a=>({code:a.code,path:W(a),pageIndex:r,eventId:t.id})),Ee=e=>e.filter(pe).map(be),rt=e=>xe(e,x).flat(2),tt=e=>he(e,x).flat(2),Ce=e=>({bgm:e.bgm,bgs:e.bgs,commands:ue(e,x)}),at=e=>({map:Ce(e.map),filename:e.filename,editingName:e.editingName}),ot=e=>({sounds:p(e.sounds),bgm:p([e.battleBgm,e.titleBgm]),me:p([e.defeatMe,e.gameoverMe,e.victoryMe])}),p=e=>e.map((r,t)=>({index:t,path:r.name})),Ie=(e,r,t)=>({key:e,text:r,id:t.id}),s=(e,r)=>({main:Ur(e,r,(t,a)=>Ie(t,a,e)),note:_(e)}),_=e=>qr(e.note,(r,t)=>Ie(r,t,e)),ct=e=>s(e,["name","nickname","profile"]),st=e=>s(e,["name"]),nt=e=>s(e,["name"]),mt=e=>s(e,["name","description","message1","message2"]),it=e=>s(e,["name","description"]),dt=e=>s(e,["name","description"]),lt=e=>s(e,["name","description"]),ut=e=>s(e,["name","message1","message2","message3","message4"]),d=e=>{const r=jr(e).flat();return R(r,Fe)},L=e=>k(e,r=>d(r.list)),Fe={changeName:e=>[m(e,1)],changeNickname:e=>[m(e,1)],changeProfile:e=>[m(e,1)],showChoices:e=>ve(e),showScrollingText:e=>[m(e.mergedBody(),0)],showMessage:e=>{const r=e.normalizedCommands(),t=m(r[0],4),a=r[1];return a?[t,m(a,0)]:[t]},choiceWhen(){return[]},comment(e){const r=e.mergedBody();return[m(r,0)]},script:e=>Te(),other:()=>[],commentBody:()=>[]},Te=e=>[],ve=e=>e.parameters[0].map((r,t)=>({code:e.code,paramIndex:t,value:r})),ht=(e,r,t)=>{const a=d(e.list);return{eventId:t.id,pageIndex:r,commands:a.flat()}},xt=e=>{const r=L(e);return{note:_(e),eventId:e.id,commands:r.flat(2)}},gt=e=>{const r=L(e);return{troopId:e.id,commands:r.flat(2)}},pt=e=>({eventId:e.id,commands:d(e.list).flat(2)}),ft=e=>({key:"battlerName",image:e.battlerName,id:e.id}),f=(e,r,t)=>({folder:t,key:r,image:e[r],id:e.id}),bt=e=>[f(e,"faceName","faces"),f(e,"characterName","characters"),f(e,"battlerName","sv_actors")],b=(e,r)=>({folder:"characters",key:r,image:e[r].characterName}),G=(e,r,t)=>({folder:t,key:r,image:e[r]}),Et=e=>[G(e,"title1Name","titles1"),G(e,"title2Name","titles2"),b(e,"boat"),b(e,"ship"),b(e,"airship")],ye=e=>R(e,Ne),Ae=e=>zr(e.filter(fe),Ne),n=(e,r,t)=>({folderName:t,command:m(e,r)}),Ne={changeActorImages:e=>[n(e,1,"characters"),n(e,3,"faces"),n(e,5,"sv_actors")],showPicture:e=>[n(e,1,"pictures")],changeBattleBackground:e=>[n(e,0,"battlebacks1"),n(e,1,"battlebacks2")],changeParallax:e=>[n(e,0,"parallaxes")],changeVehicleImage:e=>[n(e,1,"characters")],other:()=>[]},Be=(e,r,t)=>ye(e.list.filter(fe)).flatMap(c=>It(c,r,t)),Ct=(e,r,t)=>({folderName:e.folderName,command:e.command,eventId:r.id,pageIndex:t,eventName:r.name}),It=(e,r,t)=>e.map(a=>Ct(a,t,r)),Ft=e=>({commands:ue(e,Be),background1:{folderName:"battlebacks1",fileName:e.battleback1Name},background2:{folderName:"battlebacks2",fileName:e.battleback2Name},parallax:{folderName:"parallaxes",fileName:e.parallaxName}}),Me=e=>({folderName:Cr,fileName:e.characterName}),Tt=1,vt={[ee]:2,[re]:2,[y]:0,[A]:1,[w]:2,[V]:0},yt={[ee]:[4],[re]:[4],[y]:[1,2,3],[A]:[2,3,4],[w]:[0],[V]:[1]},D=e=>e.filter(Ve).flatMap(we),we=e=>{const r=yt[e.code];if(r===void 0)throw new Error(`code${e.code} is not supported`);return r.map(t=>({eventCode:e.code,index:t,variableId:e.parameters[t]}))},Ve=e=>{const r=vt[e.code];return r===void 0?!1:e.parameters[r]===Tt},Se=e=>e.flatMap(r=>Pe(r)?Re(r):[]),Pe=e=>e.code===Ge||e.code===ze||e.code===w||e.code===u,Re=e=>e.code===u?ke(e):[{variableId:e.parameters[0],code:e.code}],ke=e=>{const r=e.parameters[0],t=e.parameters[1];return Array.from({length:t-r+1},(a,c)=>({variableId:c+r,code:u}))},O=e=>({variableId:e.variableId,valid:e.variableValid,value:e.variableValue}),g=(e,r,t)=>{const a=D(e.list);return{pageIndex:r,eventId:t.id,commands:a}},At=e=>le(e,(r,t,a)=>({page:g(r,t,a),conditions:O(r.conditions)})).flat(2),Nt=e=>xe(e,g),Bt=e=>he(e,g),We=e=>e.reduce((r,t)=>{if(t.code===Q){const a=t.parameters[0];r[a]=(r[a]||0)+1}return r},{}),Mt=e=>{const r=e.pages.map(_e);return{name:e.name,eventId:e.id,pages:r}},_e=e=>({commands:Le(e.list),condtion:O(e.conditions),image:Me(e.image)}),Le=e=>({texts:d(e).flat(),calls:We(e),audios:Ee(e),variableReading:D(e),variableWriting:Se(e),images:Ae(e)});exports.audioCommandInfo=be;exports.audioPathFromCommands=W;exports.collectAudioCommands=x;exports.collectImageCommands=Be;exports.collectVariableReadCommand=g;exports.commandChoice=ve;exports.correctMapEventText=xt;exports.correctTextCommands=ht;exports.eventPageCharacterImage=Me;exports.expectAudioFromTroop=tt;exports.extractAudioCFromCommonEvents=rt;exports.extractAudioCommandsInfo=Ee;exports.extractAudioFromMap=Ce;exports.extractAudioFromMapFileInfo=at;exports.extractCommonEventCalls=We;exports.extractEventCommandData=Le;exports.extractImageFromActor=bt;exports.extractImageFromEnemy=ft;exports.extractImageFromMap=Ft;exports.extractImageFromSystem=Et;exports.extractImagesFromCommandList=Ae;exports.extractImagesFromCommandListOld=ye;exports.extractMapEvent=Mt;exports.extractNoteText=_;exports.extractPageCondition=O;exports.extractPageInfo=_e;exports.extractTextData=s;exports.extractTextFromActor=ct;exports.extractTextFromArmor=lt;exports.extractTextFromClass=nt;exports.extractTextFromCommonEvent=pt;exports.extractTextFromEnemy=st;exports.extractTextFromEventCommands=d;exports.extractTextFromEventPages=L;exports.extractTextFromItem=it;exports.extractTextFromSkill=mt;exports.extractTextFromState=ut;exports.extractTextFromTroop=gt;exports.extractTextFromWeapon=dt;exports.extractTextMapper=Fe;exports.extractVariableReadingFromCommonEvent=Nt;exports.extractVariableReadingFromMap=At;exports.extractVariableReadingFromTroop=Bt;exports.extractVariableReadingInfos=D;exports.extractVariableReference=we;exports.extractVariableWriting=Se;exports.extractVariableWritsFromControlVariable=ke;exports.extractVariableWritsFromEventCommand=Re;exports.isAudioResource=Zr;exports.isVariableReadCommand=Ve;exports.isVariableWriteCommand=Pe;exports.readScript=Te;exports.systemAudioFiles=ot;
//# sourceMappingURL=rpg-analyzer.cjs.js.map
