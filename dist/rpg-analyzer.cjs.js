"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const B=101,A=401,Y=102,q=402,l=105,g=405,v=108,M=408,X=111,$=117,ee=118,re=119,te=121,oe=122,ae=123,se=124,ce=125,p=132,T=133,ne=134,de=135,me=136,ie=137,he=138,f=139,S=140,ue=201,le=202,xe=203,ge=212,pe=223,Te=224,fe=225,Ee=230,I=241,N=245,P=249,k=250,ye=301,Fe=320,Ce=322,be=324,we=325,Be=353,z=355,_=655,x="bgm",D="se",d="me",L="bgs",E=(e,r)=>r?e===r.code:!1,Ae="MessageHeader invalid command",ve="Invalid Head",W=e=>typeof e[0]=="string"&&e.length===1,i=(e,r,t)=>{const o=[];for(let s=t;s<r.length;s++){const m=r[s];if(E(e,m)&&W(m.parameters))o.push({code:e,indent:m.indent,parameters:[m.parameters[0]]});else break}return o},G=(e,r,t)=>{const o=e[r];if(o&&E(t,o)&&W(o.parameters))return{code:t,indent:o.indent,parameters:[o.parameters[0]]};throw new Error(ve,{cause:o})},Me=(e,r)=>({head:G(e,r,v),bodys:i(M,e,r+1)}),Se=(e,r)=>({head:G(e,r,z),bodys:i(_,e,r+1)}),Ie=(e,r)=>{const t=e[r];if(t&&Ne(t))return t;throw new Error(Ae,{cause:t})},Ne=e=>!e||e.code!==B||![4,5].includes(e.parameters.length)?!1:typeof e.parameters[0]=="string"&&typeof e.parameters[1]=="number"&&typeof e.parameters[2]=="number"&&typeof e.parameters[3]=="number",Pe=(e,r)=>({head:Ie(e,r),bodys:i(A,e,r+1)}),ke="ScrollTextHeader invalid command",ze=(e,r)=>{const t=e[r];if(E(l,t))return t;const o={headCode:l,bodyCode:g,index:r};throw new Error(ke,{cause:o})},_e=(e,r)=>({head:ze(e,r),bodys:i(g,e,r+1)}),De=(e,r=`
`)=>e.map(t=>t.parameters[0]).join(r);class H{constructor(r,t){this.header=r,this.bodies=t}getBodyText(r=`
`){return De(this.getExpandedBodies(),r)}jopinHedderAndBody(){return[this.header,...this.bodies]}joinCommandBodies(){return this.getExpandedBodies()}}class y extends H{constructor(r,t,o){super(t,o),this.bodyCode=r}getExpandedBodies(){return this.bodies}normalizedCommands(){const r={...this.header,code:this.header.code,indent:this.header.indent,parameters:[...this.header.parameters]};return this.bodies.length===0?[r]:[r,this.mergedBody()]}mergedBody(){return{code:this.bodyCode,indent:this.header.indent,parameters:[this.getBodyText()]}}}class R extends H{getExpandedBodies(){return[this.header,...this.bodies]}mergedBody(){return{code:this.header.code,indent:this.header.indent,parameters:[this.getBodyText()]}}normalizedCommands(){return[this.mergedBody()]}}const Le="選択肢ヘルプ",We=e=>e.parameters[0]===Le,Ge=(e,r=[])=>new y(401,e,r),He=(e,r=[])=>new y(405,e,r),Re=(e,r=[])=>We(e)?new y(408,e,r):new R(e,r),je=(e,r=[])=>new R(e,r),Je=(e,r,t)=>{const o=Pe(e,r),s=Ge(o.head,o.bodys);return t(s)},Oe=(e,r,t)=>{const o=_e(e,r),s=He(o.head,o.bodys);return t(s)},Ve=(e,r,t)=>{const o=Me(e,r),s=Re(o.head,o.bodys);return t(s)},Qe=(e,r,t)=>{const o=Se(e,r),s=je(o.head,o.bodys);return t(s)},a=(e,r,t,o,s)=>o?o(e,r,t):s(e,r,t),j=(e,r)=>e.map((t,o)=>Ze(e,o,r)),Ze=(e,r,t)=>{const o=e[r];switch(o.code){case B:return t.showMessage?Je(e,r,t.showMessage):t.other(o,r,e);case A:return a(o,r,e,t.showMessageBody,t.other);case l:return t.showScrollingText?Oe(e,r,t.showScrollingText):t.other(o,r,e);case g:return a(o,r,e,t.showScrollingTextBody,t.other);case v:return t.comment?Ve(e,r,t.comment):t.other(o,r,e);case M:return a(o,r,e,t.commentBody,t.other);case z:return t.script?Qe(e,r,t.script):t.other(o,r,e);case _:return a(o,r,e,t.scriptBody,t.other);case te:return a(o,r,e,t.controlSwitch,t.other);case oe:return a(o,r,e,t.controlVariable,t.other);case ae:return a(o,r,e,t.controlSelfSwitch,t.other);case se:return a(o,r,e,t.controlTimer,t.other);case X:return a(o,r,e,t.conditionalBranch,t.other);case Y:return a(o,r,e,t.showChoices,t.other);case q:return a(o,r,e,t.choiceWhen,t.other);case Fe:return a(o,r,e,t.changeName,t.other);case we:return a(o,r,e,t.changeProfile,t.other);case be:return a(o,r,e,t.changeNickname,t.other);case $:return a(o,r,e,t.commonEvent,t.other);case ee:return a(o,r,e,t.label,t.other);case re:return a(o,r,e,t.labelJump,t.other);case p:return a(o,r,e,t.changeBattleBGM,t.other);case T:return a(o,r,e,t.changeVictoryME,t.other);case f:return a(o,r,e,t.changeDefeatME,t.other);case ne:return a(o,r,e,t.changeSaveAccess,t.other);case de:return a(o,r,e,t.changeMenuAccess,t.other);case me:return a(o,r,e,t.changeEncounter,t.other);case ie:return a(o,r,e,t.changeFormationAccess,t.other);case he:return a(o,r,e,t.changeWindowColor,t.other);case pe:return a(o,r,e,t.tintScreen,t.other);case Te:return a(o,r,e,t.flashScreen,t.other);case fe:return a(o,r,e,t.shakeScreen,t.other);case ye:return a(o,r,e,t.battleProcessing,t.other);case Ee:return a(o,r,e,t.wait,t.other);case Ce:return a(o,r,e,t.changeActorImages,t.other);case ce:return a(o,r,e,t.changeGold,t.other);case ge:return a(o,r,e,t.showAnimation,t.other);case ue:return a(o,r,e,t.transferPlayer,t.other);case le:return a(o,r,e,t.setVehicleLocation,t.other);case xe:return a(o,r,e,t.setEventLocation,t.other);case Be:return a(o,r,e,t.gameover,t.other)}return t.other(o,r,e)},Ke={commentBody:()=>[],showMessageBody:()=>[],scriptBody:()=>[],showScrollingTextBody:()=>[],showMessage:e=>e.normalizedCommands(),showScrollingText:e=>e.normalizedCommands(),comment:e=>e.normalizedCommands(),script:e=>e.normalizedCommands(),other:e=>[e]},Ue=e=>j(e,Ke),Ye=e=>!!e,F=(e,r)=>e.pages.map((t,o)=>r(t,o,e)),qe=(e,r)=>e.events.filter(Ye).map(t=>F(t,r)),Xe=(e,r)=>qe(e,r).flat(2),$e=(e,r)=>e.map(t=>F(t,r)),er=(e,r)=>e.map((t,o)=>r(t,o,t)),rr=()=>/<([^<>:]+):([^>]*)>/g,tr=(e,r)=>{const t=rr(),o=[];let s;for(;(s=t.exec(e))!==null;)o.push(r(s[1],s[2]));return o},or=(e,r,t)=>r.map(o=>t(o,e[o],e)),ar=(e,r,t)=>or(e,r,t),n=(e,r)=>({code:e.code,paramIndex:r,value:e.parameters[r]}),sr=e=>e.folder===D||e.folder===x||e.folder===L||e.folder===d,cr=[I,N,P,k,p,T,f,S],J=e=>cr.includes(e.code),O=e=>({folder:nr(e)||"",fileName:e.parameters[0].name}),nr=e=>dr[e.code],dr={[I]:x,[N]:L,[P]:d,[k]:D,[p]:x,[T]:d,[f]:d,[S]:d},h=(e,r,t)=>e.list.filter(J).map(o=>({code:o.code,path:O(o),pageIndex:r,eventId:t.id})),mr=e=>er(e,h).flat(2),ir=e=>$e(e,h).flat(2),V=e=>({bgm:e.bgm,bgs:e.bgs,commands:Xe(e,h)}),hr=e=>({map:V(e.map),filename:e.filename,editingName:e.editingName}),ur=e=>({sounds:u(e.sounds),bgm:u([e.battleBgm,e.titleBgm]),me:u([e.defeatMe,e.gameoverMe,e.victoryMe])}),u=e=>e.map((r,t)=>({index:t,path:r.name})),Q=(e,r,t)=>({key:e,text:r,id:t.id}),c=(e,r)=>({main:ar(e,r,(t,o)=>Q(t,o,e)),note:C(e)}),C=e=>tr(e.note,(r,t)=>Q(r,t,e)),lr=e=>c(e,["name","nickname","profile"]),xr=e=>c(e,["name"]),gr=e=>c(e,["name"]),pr=e=>c(e,["name","description","message1","message2"]),Tr=e=>c(e,["name","description"]),fr=e=>c(e,["name","description"]),Er=e=>c(e,["name","description"]),yr=e=>c(e,["name","message1","message2","message3","message4"]),b=e=>{const r=Ue(e).flat();return j(r,Z)},w=e=>F(e,r=>b(r.list)),Z={changeName:e=>[n(e,1)],changeNickname:e=>[n(e,1)],changeProfile:e=>[n(e,1)],showChoices:e=>U(e),showScrollingText:e=>[n(e.mergedBody(),0)],showMessage:e=>{const r=e.normalizedCommands(),t=n(r[0],4),o=r[1];return o?[t,n(o,0)]:[t]},choiceWhen(){return[]},comment(e){const r=e.mergedBody();return[n(r,0)]},script:e=>K(),other:()=>[],commentBody:()=>[]},K=e=>[],U=e=>e.parameters[0].map((r,t)=>({code:e.code,paramIndex:t,value:r})),Fr=e=>{const r=w(e);return{note:C(e),eventId:e.id,commands:r.flat(2)}},Cr=e=>{const r=w(e);return{troopId:e.id,commands:r.flat(2)}},br=e=>({eventId:e.id,commands:b(e.list).flat(2)});exports.audioPathFromCommands=O;exports.collectAudioCommands=h;exports.commandChoice=U;exports.correctMapEventText=Fr;exports.expectAudioFromTroop=ir;exports.extractAudioCFromCommonEvents=mr;exports.extractAudioFromMap=V;exports.extractAudioFromMapFileInfo=hr;exports.extractNoteText=C;exports.extractTextData=c;exports.extractTextFromActor=lr;exports.extractTextFromArmor=Er;exports.extractTextFromClass=gr;exports.extractTextFromCommonEvent=br;exports.extractTextFromEnemy=xr;exports.extractTextFromEventCommands=b;exports.extractTextFromEventPages=w;exports.extractTextFromItem=Tr;exports.extractTextFromSkill=pr;exports.extractTextFromState=yr;exports.extractTextFromTroop=Cr;exports.extractTextFromWeapon=fr;exports.extractTextMapper=Z;exports.isAudioCommand=J;exports.isAudioResource=sr;exports.readScript=K;exports.systemAudioFiles=ur;
//# sourceMappingURL=rpg-analyzer.cjs.js.map
