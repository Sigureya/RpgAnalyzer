"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const z=101,H=401,_e=102,Le=402,We=103,De=104,E=105,I=405,j=108,J=408,Oe=111,Q=117,Ge=118,ze=119,He=121,u=122,je=123,Je=124,Qe=125,F=132,T=133,Xe=134,Ye=135,qe=136,Ke=137,Ue=138,v=139,X=140,y=201,A=202,Ze=203,$e=211,er=212,rr=223,tr=224,ar=225,or=230,Y=231,cr=232,sr=233,nr=234,mr=235,ir=236,N=241,dr=242,q=245,B=249,M=250,lr=251,ur=261,K=283,U=284,w=285,S=301,hr=320,Z=322,$=323,xr=324,gr=325,ee=331,re=332,pr=353,te=355,ae=655,C="bgm",oe="se",i="me",ce="bgs",fr="characters",V=(e,r)=>r?e===r.code:!1,br="MessageHeader invalid command",Er="Invalid Head",se=e=>typeof e[0]=="string"&&e.length===1,h=(e,r,t)=>{const a=[];for(let c=t;c<r.length;c++){const l=r[c];if(V(e,l)&&se(l.parameters))a.push({code:e,indent:l.indent,parameters:[l.parameters[0]]});else break}return a},ne=(e,r,t)=>{const a=e[r];if(a&&V(t,a)&&se(a.parameters))return{code:t,indent:a.indent,parameters:[a.parameters[0]]};throw new Error(Er,{cause:a})},Cr=(e,r)=>({head:ne(e,r,j),bodys:h(J,e,r+1)}),Ir=(e,r)=>({head:ne(e,r,te),bodys:h(ae,e,r+1)}),Fr=(e,r)=>{const t=e[r];if(t&&Tr(t))return t;throw new Error(br,{cause:t})},Tr=e=>!e||e.code!==z||![4,5].includes(e.parameters.length)?!1:typeof e.parameters[0]=="string"&&typeof e.parameters[1]=="number"&&typeof e.parameters[2]=="number"&&typeof e.parameters[3]=="number",vr=(e,r)=>({head:Fr(e,r),bodys:h(H,e,r+1)}),yr="ScrollTextHeader invalid command",Ar=(e,r)=>{const t=e[r];if(V(E,t))return t;const a={headCode:E,bodyCode:I,index:r};throw new Error(yr,{cause:a})},Nr=(e,r)=>({head:Ar(e,r),bodys:h(I,e,r+1)}),Br=(e,r=`
`)=>e.map(t=>t.parameters[0]).join(r);class me{constructor(r,t){this.header=r,this.bodies=t}getBodyText(r=`
`){return Br(this.getExpandedBodies(),r)}jopinHedderAndBody(){return[this.header,...this.bodies]}joinCommandBodies(){return this.getExpandedBodies()}}class P extends me{constructor(r,t,a){super(t,a),this.bodyCode=r}getExpandedBodies(){return this.bodies}normalizedCommands(){const r={...this.header,code:this.header.code,indent:this.header.indent,parameters:[...this.header.parameters]};return this.bodies.length===0?[r]:[r,this.mergedBody()]}mergedBody(){return{code:this.bodyCode,indent:this.header.indent,parameters:[this.getBodyText()]}}}class ie extends me{getExpandedBodies(){return[this.header,...this.bodies]}mergedBody(){return{code:this.header.code,indent:this.header.indent,parameters:[this.getBodyText()]}}normalizedCommands(){return[this.mergedBody()]}}const Mr="選択肢ヘルプ",wr=e=>e.parameters[0]===Mr,Sr=(e,r=[])=>new P(401,e,r),Vr=(e,r=[])=>new P(405,e,r),Pr=(e,r=[])=>wr(e)?new P(408,e,r):new ie(e,r),Rr=(e,r=[])=>new ie(e,r),kr=(e,r,t)=>{const a=vr(e,r),c=Sr(a.head,a.bodys);return t(c)},_r=(e,r,t)=>{const a=Nr(e,r),c=Vr(a.head,a.bodys);return t(c)},Lr=(e,r,t)=>{const a=Cr(e,r),c=Pr(a.head,a.bodys);return t(c)},Wr=(e,r,t)=>{const a=Ir(e,r),c=Rr(a.head,a.bodys);return t(c)},o=(e,r,t,a,c)=>a?a(e,r,t):c(e,r,t),R=(e,r)=>e.map((t,a)=>de(e,a,r)),Dr=(e,r)=>e.flatMap((t,a)=>de(e,a,r)),de=(e,r,t)=>{const a=e[r];switch(a.code){case z:return t.showMessage?kr(e,r,t.showMessage):t.other(a,r,e);case H:return o(a,r,e,t.showMessageBody,t.other);case E:return t.showScrollingText?_r(e,r,t.showScrollingText):t.other(a,r,e);case I:return o(a,r,e,t.showScrollingTextBody,t.other);case _e:return o(a,r,e,t.showChoices,t.other);case Le:return o(a,r,e,t.choiceWhen,t.other);case j:return t.comment?Lr(e,r,t.comment):t.other(a,r,e);case J:return o(a,r,e,t.commentBody,t.other);case te:return t.script?Wr(e,r,t.script):t.other(a,r,e);case ae:return o(a,r,e,t.scriptBody,t.other);case Oe:return o(a,r,e,t.conditionalBranch,t.other);case He:return o(a,r,e,t.controlSwitch,t.other);case u:return o(a,r,e,t.controlVariable,t.other);case je:return o(a,r,e,t.controlSelfSwitch,t.other);case Je:return o(a,r,e,t.controlTimer,t.other);case Q:return o(a,r,e,t.commonEvent,t.other);case Xe:return o(a,r,e,t.changeSaveAccess,t.other);case Ye:return o(a,r,e,t.changeMenuAccess,t.other);case qe:return o(a,r,e,t.changeEncounter,t.other);case Ke:return o(a,r,e,t.changeFormationAccess,t.other);case hr:return o(a,r,e,t.changeName,t.other);case gr:return o(a,r,e,t.changeProfile,t.other);case xr:return o(a,r,e,t.changeNickname,t.other);case Z:return o(a,r,e,t.changeActorImages,t.other);case $:return o(a,r,e,t.changeVehicleImage,t.other);case F:return o(a,r,e,t.changeBattleBGM,t.other);case T:return o(a,r,e,t.changeVictoryME,t.other);case v:return o(a,r,e,t.changeDefeatME,t.other);case N:return o(a,r,e,t.playBGM,t.other);case dr:return o(a,r,e,t.fadeOutBGM,t.other);case M:return o(a,r,e,t.playSE,t.other);case lr:return o(a,r,e,t.stopSE,t.other);case B:return o(a,r,e,t.playME,t.other);case Ge:return o(a,r,e,t.label,t.other);case ze:return o(a,r,e,t.labelJump,t.other);case Ue:return o(a,r,e,t.changeWindowColor,t.other);case rr:return o(a,r,e,t.tintScreen,t.other);case tr:return o(a,r,e,t.flashScreen,t.other);case ar:return o(a,r,e,t.shakeScreen,t.other);case Y:return o(a,r,e,t.showPicture,t.other);case cr:return o(a,r,e,t.movePicture,t.other);case sr:return o(a,r,e,t.rotatePicture,t.other);case nr:return o(a,r,e,t.tintPicture,t.other);case mr:return o(a,r,e,t.erasePicture,t.other);case S:return o(a,r,e,t.battleProcessing,t.other);case or:return o(a,r,e,t.wait,t.other);case pr:return o(a,r,e,t.gameover,t.other);case U:return o(a,r,e,t.changeParallax,t.other);case K:return o(a,r,e,t.changeBattleBackground,t.other);case ur:return o(a,r,e,t.playMovie,t.other);case $e:return o(a,r,e,t.changeTransparency,t.other);case ir:return o(a,r,e,t.setWeatherEffects,t.other);case Qe:return o(a,r,e,t.changeGold,t.other);case er:return o(a,r,e,t.showAnimation,t.other);case y:return o(a,r,e,t.transferPlayer,t.other);case A:return o(a,r,e,t.setVehicleLocation,t.other);case Ze:return o(a,r,e,t.setEventLocation,t.other);default:return t.other(a,r,e)}},Or={commentBody:()=>[],showMessageBody:()=>[],scriptBody:()=>[],showScrollingTextBody:()=>[],showMessage:e=>e.normalizedCommands(),showScrollingText:e=>e.normalizedCommands(),comment:e=>e.normalizedCommands(),script:e=>e.normalizedCommands(),other:e=>[e]},Gr=e=>R(e,Or),zr=e=>!!e,k=(e,r)=>e.pages.map((t,a)=>r(t,a,e)),le=(e,r)=>e.events.filter(zr).map(t=>k(t,r)),ue=(e,r)=>le(e,r).flat(2),he=(e,r)=>e.map(t=>k(t,r)),xe=(e,r)=>e.map(t=>r(t,0,t)),ge=(e,r)=>r.includes(e.code),pe=e=>ge(e,Hr),Hr=[N,q,B,M,F,T,v,X],fe=e=>ge(e,jr),jr=[Y,Z,$,U,K],m=(e,r)=>({code:e.code,paramIndex:r,value:e.parameters[r]}),Jr=()=>/<([^<>:]+):([^>]*)>/g,Qr=(e,r)=>{const t=Jr(),a=[];let c;for(;(c=t.exec(e))!==null;)a.push(r(c[1],c[2]));return a},Xr=(e,r,t)=>r.map(a=>t(a,e[a],e)),Yr=(e,r,t)=>Xr(e,r,t),qr=e=>e.folder===oe||e.folder===C||e.folder===ce||e.folder===i,be=e=>({code:e.code,path:_(e)}),_=e=>({folder:Kr(e)||"",fileName:e.parameters[0].name}),Kr=e=>Ur[e.code],Ur={[N]:C,[q]:ce,[B]:i,[M]:oe,[F]:C,[T]:i,[v]:i,[X]:i},x=(e,r,t)=>e.list.filter(pe).map(a=>({code:a.code,path:_(a),pageIndex:r,eventId:t.id})),Ee=e=>e.filter(pe).map(be),Zr=e=>xe(e,x).flat(2),$r=e=>he(e,x).flat(2),Ce=e=>({bgm:e.bgm,bgs:e.bgs,commands:ue(e,x)}),et=e=>({map:Ce(e.map),filename:e.filename,editingName:e.editingName}),rt=e=>({sounds:p(e.sounds),bgm:p([e.battleBgm,e.titleBgm]),me:p([e.defeatMe,e.gameoverMe,e.victoryMe])}),p=e=>e.map((r,t)=>({index:t,path:r.name})),Ie=(e,r,t)=>({key:e,text:r,id:t.id}),s=(e,r)=>({main:Yr(e,r,(t,a)=>Ie(t,a,e)),note:L(e)}),L=e=>Qr(e.note,(r,t)=>Ie(r,t,e)),tt=e=>s(e,["name","nickname","profile"]),at=e=>s(e,["name"]),ot=e=>s(e,["name"]),ct=e=>s(e,["name","description","message1","message2"]),st=e=>s(e,["name","description"]),nt=e=>s(e,["name","description"]),mt=e=>s(e,["name","description"]),it=e=>s(e,["name","message1","message2","message3","message4"]),d=e=>{const r=Gr(e).flat();return R(r,Fe)},W=e=>k(e,r=>d(r.list)),Fe={changeName:e=>[m(e,1)],changeNickname:e=>[m(e,1)],changeProfile:e=>[m(e,1)],showChoices:e=>ve(e),showScrollingText:e=>[m(e.mergedBody(),0)],showMessage:e=>{const r=e.normalizedCommands(),t=m(r[0],4),a=r[1];return a?[t,m(a,0)]:[t]},choiceWhen(){return[]},comment(e){const r=e.mergedBody();return[m(r,0)]},script:e=>Te(),other:()=>[],commentBody:()=>[]},Te=e=>[],ve=e=>e.parameters[0].map((r,t)=>({code:e.code,paramIndex:t,value:r})),dt=(e,r,t)=>{const a=d(e.list);return{eventId:t.id,pageIndex:r,commands:a.flat()}},lt=e=>{const r=W(e);return{note:L(e),eventId:e.id,commands:r.flat(2)}},ut=e=>{const r=W(e);return{troopId:e.id,commands:r.flat(2)}},ht=e=>({eventId:e.id,commands:d(e.list).flat(2)}),xt=e=>({key:"battlerName",image:e.battlerName,id:e.id}),f=(e,r,t)=>({folder:t,key:r,image:e[r],id:e.id}),gt=e=>[f(e,"faceName","faces"),f(e,"characterName","characters"),f(e,"battlerName","sv_actors")],b=(e,r)=>({folder:"characters",key:r,image:e[r].characterName}),G=(e,r,t)=>({folder:t,key:r,image:e[r]}),pt=e=>[G(e,"title1Name","titles1"),G(e,"title2Name","titles2"),b(e,"boat"),b(e,"ship"),b(e,"airship")],ye=e=>R(e,Ne),Ae=e=>Dr(e.filter(fe),Ne),n=(e,r,t)=>({folderName:t,command:m(e,r)}),Ne={changeActorImages:e=>[n(e,1,"characters"),n(e,3,"faces"),n(e,5,"sv_actors")],showPicture:e=>[n(e,1,"pictures")],changeBattleBackground:e=>[n(e,0,"battlebacks1"),n(e,1,"battlebacks2")],changeParallax:e=>[n(e,0,"parallaxes")],changeVehicleImage:e=>[n(e,1,"characters")],other:()=>[]},Be=(e,r,t)=>ye(e.list.filter(fe)).flatMap(c=>bt(c,r,t)),ft=(e,r,t)=>({folderName:e.folderName,command:e.command,eventId:r.id,pageIndex:t,eventName:r.name}),bt=(e,r,t)=>e.map(a=>ft(a,t,r)),Et=e=>({commands:ue(e,Be),background1:{folderName:"battlebacks1",fileName:e.battleback1Name},background2:{folderName:"battlebacks2",fileName:e.battleback2Name},parallax:{folderName:"parallaxes",fileName:e.parallaxName}}),Me=e=>({folderName:fr,fileName:e.characterName}),Ct=1,It={[ee]:2,[re]:2,[y]:0,[A]:1,[w]:2,[S]:0},Ft={[ee]:[4],[re]:[4],[y]:[1,2,3],[A]:[2,3,4],[w]:[0],[S]:[1]},D=e=>e.filter(Se).flatMap(we),we=e=>{const r=Ft[e.code];if(r===void 0)throw new Error(`code${e.code} is not supported`);return r.map(t=>({eventCode:e.code,index:t,variableId:e.parameters[t]}))},Se=e=>{const r=It[e.code];return r===void 0?!1:e.parameters[r]===Ct},Tt=e=>e.code===We||e.code===De||e.code===w||e.code===u,vt=e=>e.code===u?Ve(e):[{variableId:e.parameters[0],code:e.code}],Ve=e=>{const r=e.parameters[0],t=e.parameters[1];return Array.from({length:t-r+1},(a,c)=>({variableId:c+r,code:u}))},O=e=>({variableId:e.variableId,valid:e.variableValid,value:e.variableValue}),g=(e,r,t)=>{const a=D(e.list);return{pageIndex:r,eventId:t.id,commands:a}},yt=e=>le(e,(r,t,a)=>({page:g(r,t,a),conditions:O(r.conditions)})).flat(2),At=e=>xe(e,g),Nt=e=>he(e,g),Pe=e=>e.reduce((r,t)=>{if(t.code===Q){const a=t.parameters[0];r[a]=(r[a]||0)+1}return r},{}),Bt=e=>{const r=e.pages.map(Re);return{name:e.name,eventId:e.id,pages:r}},Re=e=>({commands:ke(e.list),condtion:O(e.conditions),image:Me(e.image)}),ke=e=>({texts:d(e).flat(),calls:Pe(e),audios:Ee(e),variableReading:D(e),variableWriting:[],images:Ae(e)});exports.audioCommandInfo=be;exports.audioPathFromCommands=_;exports.collectAudioCommands=x;exports.collectImageCommands=Be;exports.collectVariableReadCommand=g;exports.commandChoice=ve;exports.correctMapEventText=lt;exports.correctTextCommands=dt;exports.eventPageCharacterImage=Me;exports.expectAudioFromTroop=$r;exports.extractAudioCFromCommonEvents=Zr;exports.extractAudioCommandsInfo=Ee;exports.extractAudioFromMap=Ce;exports.extractAudioFromMapFileInfo=et;exports.extractCommonEventCalls=Pe;exports.extractEventCommandData=ke;exports.extractImageFromActor=gt;exports.extractImageFromEnemy=xt;exports.extractImageFromMap=Et;exports.extractImageFromSystem=pt;exports.extractImagesFromCommandList=Ae;exports.extractImagesFromCommandListOld=ye;exports.extractMapEvent=Bt;exports.extractNoteText=L;exports.extractPageCondition=O;exports.extractPageInfo=Re;exports.extractTextData=s;exports.extractTextFromActor=tt;exports.extractTextFromArmor=mt;exports.extractTextFromClass=ot;exports.extractTextFromCommonEvent=ht;exports.extractTextFromEnemy=at;exports.extractTextFromEventCommands=d;exports.extractTextFromEventPages=W;exports.extractTextFromItem=st;exports.extractTextFromSkill=ct;exports.extractTextFromState=it;exports.extractTextFromTroop=ut;exports.extractTextFromWeapon=nt;exports.extractTextMapper=Fe;exports.extractVariableReadingFromCommonEvent=At;exports.extractVariableReadingFromMap=yt;exports.extractVariableReadingFromTroop=Nt;exports.extractVariableReadingInfos=D;exports.extractVariableReference=we;exports.extractVariableWritsFromControlVariable=Ve;exports.extractVariableWritsFromEventCommand=vt;exports.isAudioResource=qr;exports.isVariableReadCommand=Se;exports.isVariableWriteCommand=Tt;exports.readScript=Te;exports.systemAudioFiles=rt;
//# sourceMappingURL=rpg-analyzer.cjs.js.map
