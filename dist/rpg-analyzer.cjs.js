"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const z=101,H=401,ye=102,Ae=402,Be=103,Ne=104,E=105,C=405,j=108,J=408,we=111,X=117,Me=118,Ve=119,Se=121,l=122,Pe=123,Re=124,_e=125,T=132,I=133,ke=134,We=135,Le=136,De=137,Ge=138,v=139,Y=140,y=201,A=202,Oe=203,ze=211,He=212,je=223,Je=224,Xe=225,Ye=230,q=231,qe=232,Ke=233,Qe=234,Ue=235,Ze=236,B=241,$e=242,K=245,N=249,w=250,er=251,rr=261,Q=283,U=284,M=285,V=301,tr=320,Z=322,$=323,ar=324,or=325,ee=331,re=332,sr=353,te=355,ae=655,F="bgm",oe="se",i="me",se="bgs",S=(e,t)=>t?e===t.code:!1,cr="MessageHeader invalid command",nr="Invalid Head",ce=e=>typeof e[0]=="string"&&e.length===1,u=(e,t,r)=>{const a=[];for(let s=r;s<t.length;s++){const d=t[s];if(S(e,d)&&ce(d.parameters))a.push({code:e,indent:d.indent,parameters:[d.parameters[0]]});else break}return a},ne=(e,t,r)=>{const a=e[t];if(a&&S(r,a)&&ce(a.parameters))return{code:r,indent:a.indent,parameters:[a.parameters[0]]};throw new Error(nr,{cause:a})},mr=(e,t)=>({head:ne(e,t,j),bodys:u(J,e,t+1)}),ir=(e,t)=>({head:ne(e,t,te),bodys:u(ae,e,t+1)}),dr=(e,t)=>{const r=e[t];if(r&&lr(r))return r;throw new Error(cr,{cause:r})},lr=e=>!e||e.code!==z||![4,5].includes(e.parameters.length)?!1:typeof e.parameters[0]=="string"&&typeof e.parameters[1]=="number"&&typeof e.parameters[2]=="number"&&typeof e.parameters[3]=="number",ur=(e,t)=>({head:dr(e,t),bodys:u(H,e,t+1)}),hr="ScrollTextHeader invalid command",xr=(e,t)=>{const r=e[t];if(S(E,r))return r;const a={headCode:E,bodyCode:C,index:t};throw new Error(hr,{cause:a})},gr=(e,t)=>({head:xr(e,t),bodys:u(C,e,t+1)}),pr=(e,t=`
`)=>e.map(r=>r.parameters[0]).join(t);class me{constructor(t,r){this.header=t,this.bodies=r}getBodyText(t=`
`){return pr(this.getExpandedBodies(),t)}jopinHedderAndBody(){return[this.header,...this.bodies]}joinCommandBodies(){return this.getExpandedBodies()}}class P extends me{constructor(t,r,a){super(r,a),this.bodyCode=t}getExpandedBodies(){return this.bodies}normalizedCommands(){const t={...this.header,code:this.header.code,indent:this.header.indent,parameters:[...this.header.parameters]};return this.bodies.length===0?[t]:[t,this.mergedBody()]}mergedBody(){return{code:this.bodyCode,indent:this.header.indent,parameters:[this.getBodyText()]}}}class ie extends me{getExpandedBodies(){return[this.header,...this.bodies]}mergedBody(){return{code:this.header.code,indent:this.header.indent,parameters:[this.getBodyText()]}}normalizedCommands(){return[this.mergedBody()]}}const br="選択肢ヘルプ",fr=e=>e.parameters[0]===br,Er=(e,t=[])=>new P(401,e,t),Fr=(e,t=[])=>new P(405,e,t),Cr=(e,t=[])=>fr(e)?new P(408,e,t):new ie(e,t),Tr=(e,t=[])=>new ie(e,t),Ir=(e,t,r)=>{const a=ur(e,t),s=Er(a.head,a.bodys);return r(s)},vr=(e,t,r)=>{const a=gr(e,t),s=Fr(a.head,a.bodys);return r(s)},yr=(e,t,r)=>{const a=mr(e,t),s=Cr(a.head,a.bodys);return r(s)},Ar=(e,t,r)=>{const a=ir(e,t),s=Tr(a.head,a.bodys);return r(s)},o=(e,t,r,a,s)=>a?a(e,t,r):s(e,t,r),R=(e,t)=>e.map((r,a)=>Br(e,a,t)),Br=(e,t,r)=>{const a=e[t];switch(a.code){case z:return r.showMessage?Ir(e,t,r.showMessage):r.other(a,t,e);case H:return o(a,t,e,r.showMessageBody,r.other);case E:return r.showScrollingText?vr(e,t,r.showScrollingText):r.other(a,t,e);case C:return o(a,t,e,r.showScrollingTextBody,r.other);case ye:return o(a,t,e,r.showChoices,r.other);case Ae:return o(a,t,e,r.choiceWhen,r.other);case j:return r.comment?yr(e,t,r.comment):r.other(a,t,e);case J:return o(a,t,e,r.commentBody,r.other);case te:return r.script?Ar(e,t,r.script):r.other(a,t,e);case ae:return o(a,t,e,r.scriptBody,r.other);case we:return o(a,t,e,r.conditionalBranch,r.other);case Se:return o(a,t,e,r.controlSwitch,r.other);case l:return o(a,t,e,r.controlVariable,r.other);case Pe:return o(a,t,e,r.controlSelfSwitch,r.other);case Re:return o(a,t,e,r.controlTimer,r.other);case X:return o(a,t,e,r.commonEvent,r.other);case ke:return o(a,t,e,r.changeSaveAccess,r.other);case We:return o(a,t,e,r.changeMenuAccess,r.other);case Le:return o(a,t,e,r.changeEncounter,r.other);case De:return o(a,t,e,r.changeFormationAccess,r.other);case tr:return o(a,t,e,r.changeName,r.other);case or:return o(a,t,e,r.changeProfile,r.other);case ar:return o(a,t,e,r.changeNickname,r.other);case Z:return o(a,t,e,r.changeActorImages,r.other);case $:return o(a,t,e,r.changeVehicleImage,r.other);case T:return o(a,t,e,r.changeBattleBGM,r.other);case I:return o(a,t,e,r.changeVictoryME,r.other);case v:return o(a,t,e,r.changeDefeatME,r.other);case B:return o(a,t,e,r.playBGM,r.other);case $e:return o(a,t,e,r.fadeOutBGM,r.other);case w:return o(a,t,e,r.playSE,r.other);case er:return o(a,t,e,r.stopSE,r.other);case N:return o(a,t,e,r.playME,r.other);case Me:return o(a,t,e,r.label,r.other);case Ve:return o(a,t,e,r.labelJump,r.other);case Ge:return o(a,t,e,r.changeWindowColor,r.other);case je:return o(a,t,e,r.tintScreen,r.other);case Je:return o(a,t,e,r.flashScreen,r.other);case Xe:return o(a,t,e,r.shakeScreen,r.other);case q:return o(a,t,e,r.showPicture,r.other);case qe:return o(a,t,e,r.movePicture,r.other);case Ke:return o(a,t,e,r.rotatePicture,r.other);case Qe:return o(a,t,e,r.tintPicture,r.other);case Ue:return o(a,t,e,r.erasePicture,r.other);case V:return o(a,t,e,r.battleProcessing,r.other);case Ye:return o(a,t,e,r.wait,r.other);case sr:return o(a,t,e,r.gameover,r.other);case U:return o(a,t,e,r.changeParallax,r.other);case Q:return o(a,t,e,r.changeBattleBackground,r.other);case rr:return o(a,t,e,r.playMovie,r.other);case ze:return o(a,t,e,r.changeTransparency,r.other);case Ze:return o(a,t,e,r.setWeatherEffects,r.other);case _e:return o(a,t,e,r.changeGold,r.other);case He:return o(a,t,e,r.showAnimation,r.other);case y:return o(a,t,e,r.transferPlayer,r.other);case A:return o(a,t,e,r.setVehicleLocation,r.other);case Oe:return o(a,t,e,r.setEventLocation,r.other);default:return r.other(a,t,e)}},Nr={commentBody:()=>[],showMessageBody:()=>[],scriptBody:()=>[],showScrollingTextBody:()=>[],showMessage:e=>e.normalizedCommands(),showScrollingText:e=>e.normalizedCommands(),comment:e=>e.normalizedCommands(),script:e=>e.normalizedCommands(),other:e=>[e]},wr=e=>R(e,Nr),Mr=e=>!!e,_=(e,t)=>e.pages.map((r,a)=>t(r,a,e)),de=(e,t)=>e.events.filter(Mr).map(r=>_(r,t)),le=(e,t)=>de(e,t).flat(2),k=(e,t)=>e.map(r=>_(r,t)),W=(e,t)=>e.map(r=>t(r,0,r)),ue=(e,t)=>t.includes(e.code),Vr=e=>ue(e,Sr),Sr=[B,K,N,w,T,I,v,Y],Pr=e=>ue(e,Rr),Rr=[q,Z,$,U,Q],m=(e,t)=>({code:e.code,paramIndex:t,value:e.parameters[t]}),_r=()=>/<([^<>:]+):([^>]*)>/g,kr=(e,t)=>{const r=_r(),a=[];let s;for(;(s=r.exec(e))!==null;)a.push(t(s[1],s[2]));return a},Wr=(e,t,r)=>t.map(a=>r(a,e[a],e)),Lr=(e,t,r)=>Wr(e,t,r),Dr=e=>e.folder===oe||e.folder===F||e.folder===se||e.folder===i,he=e=>({folder:Gr(e)||"",fileName:e.parameters[0].name}),Gr=e=>Or[e.code],Or={[B]:F,[K]:se,[N]:i,[w]:oe,[T]:F,[I]:i,[v]:i,[Y]:i},h=(e,t,r)=>e.list.filter(Vr).map(a=>({code:a.code,path:he(a),pageIndex:t,eventId:r.id})),zr=e=>W(e,h).flat(2),Hr=e=>k(e,h).flat(2),xe=e=>({bgm:e.bgm,bgs:e.bgs,commands:le(e,h)}),jr=e=>({map:xe(e.map),filename:e.filename,editingName:e.editingName}),Jr=e=>({sounds:p(e.sounds),bgm:p([e.battleBgm,e.titleBgm]),me:p([e.defeatMe,e.gameoverMe,e.victoryMe])}),p=e=>e.map((t,r)=>({index:r,path:t.name})),ge=(e,t,r)=>({key:e,text:t,id:r.id}),c=(e,t)=>({main:Lr(e,t,(r,a)=>ge(r,a,e)),note:L(e)}),L=e=>kr(e.note,(t,r)=>ge(t,r,e)),Xr=e=>c(e,["name","nickname","profile"]),Yr=e=>c(e,["name"]),qr=e=>c(e,["name"]),Kr=e=>c(e,["name","description","message1","message2"]),Qr=e=>c(e,["name","description"]),Ur=e=>c(e,["name","description"]),Zr=e=>c(e,["name","description"]),$r=e=>c(e,["name","message1","message2","message3","message4"]),D=e=>{const t=wr(e).flat();return R(t,pe)},G=e=>_(e,t=>D(t.list)),pe={changeName:e=>[m(e,1)],changeNickname:e=>[m(e,1)],changeProfile:e=>[m(e,1)],showChoices:e=>fe(e),showScrollingText:e=>[m(e.mergedBody(),0)],showMessage:e=>{const t=e.normalizedCommands(),r=m(t[0],4),a=t[1];return a?[r,m(a,0)]:[r]},choiceWhen(){return[]},comment(e){const t=e.mergedBody();return[m(t,0)]},script:e=>be(),other:()=>[],commentBody:()=>[]},be=e=>[],fe=e=>e.parameters[0].map((t,r)=>({code:e.code,paramIndex:r,value:t})),et=e=>{const t=G(e);return{note:L(e),eventId:e.id,commands:t.flat(2)}},rt=e=>{const t=G(e);return{troopId:e.id,commands:t.flat(2)}},tt=e=>({eventId:e.id,commands:D(e.list).flat(2)}),at=e=>({key:"battlerName",image:e.battlerName,id:e.id}),b=(e,t,r)=>({folder:r,key:t,image:e[t],id:e.id}),ot=e=>[b(e,"faceName","faces"),b(e,"characterName","characters"),b(e,"battlerName","sv_actors")],f=(e,t)=>({folder:"characters",key:t,image:e[t].characterName}),O=(e,t,r)=>({folder:r,key:t,image:e[t]}),st=e=>[O(e,"title1Name","titles1"),O(e,"title2Name","titles2"),f(e,"boat"),f(e,"ship"),f(e,"airship")],Ee=e=>R(e,ct),n=(e,t,r)=>({folderName:r,command:m(e,t)}),ct={changeActorImages:e=>[n(e,1,"characters"),n(e,3,"faces"),n(e,5,"sv_actors")],showPicture:e=>[n(e,1,"pictures")],changeBattleBackground:e=>[n(e,0,"battlebacks1"),n(e,1,"battlebacks2")],changeParallax:e=>[n(e,0,"parallaxes")],changeVehicleImage:e=>[n(e,1,"characters")],other:()=>[]},nt=e=>k(e,x).flat(2),mt=e=>W(e,x).flat(2),it=e=>({commands:le(e,x),background1:{folderName:"battlebacks1",fileName:e.battleback1Name},background2:{folderName:"battlebacks2",fileName:e.battleback2Name},parallax:{folderName:"parallaxes",fileName:e.parallaxName}}),x=(e,t,r)=>Ee(e.list.filter(Pr)).flatMap(s=>lt(s,t,r)),dt=(e,t,r)=>({folderName:e.folderName,command:e.command,eventId:t.id,pageIndex:r,eventName:t.name}),lt=(e,t,r)=>e.map(a=>dt(a,r,t)),ut=1,ht={[ee]:2,[re]:2,[y]:0,[A]:1,[M]:2,[V]:0},xt={[ee]:[4],[re]:[4],[y]:[1,2,3],[A]:[2,3,4],[M]:[0],[V]:[1]},Fe=e=>e.filter(Te).flatMap(Ce),Ce=e=>{const t=xt[e.code];if(t===void 0)throw new Error(`code${e.code} is not supported`);return t.map(r=>({eventCode:e.code,index:r,variableId:e.parameters[r]}))},Te=e=>{const t=ht[e.code];return t===void 0?!1:e.parameters[t]===ut},gt=e=>e.code===Be||e.code===Ne||e.code===M||e.code===l,pt=e=>e.code===l?Ie(e):[{variableId:e.parameters[0],code:e.code}],Ie=e=>{const t=e.parameters[0],r=e.parameters[1];return Array.from({length:r-t+1},(a,s)=>({variableId:s+t,code:l}))},g=(e,t,r)=>{const a=Fe(e.list);return{pageIndex:t,eventId:r.id,commands:a}},bt=e=>de(e,(t,r,a)=>({page:g(t,r,a),conditions:ve(t.conditions)})).flat(2),ve=e=>({variableId:e.variableId,valid:e.variableValid,value:e.variableValue}),ft=e=>W(e,g),Et=e=>k(e,g),Ft=e=>e.reduce((t,r)=>{if(r.code===X){const a=r.parameters[0];t[a]=(t[a]||0)+1}return t},{});exports.audioPathFromCommands=he;exports.collectAudioCommands=h;exports.collectImageCommands=x;exports.collectVariableReadCommand=g;exports.commandChoice=fe;exports.correctMapEventText=et;exports.expectAudioFromTroop=Hr;exports.extractAudioCFromCommonEvents=zr;exports.extractAudioFromMap=xe;exports.extractAudioFromMapFileInfo=jr;exports.extractCommonEventCalls=Ft;exports.extractImageFromActor=ot;exports.extractImageFromEnemy=at;exports.extractImageFromSystem=st;exports.extractImagesFromCommandList=Ee;exports.extractImagesFromCommonEvents=mt;exports.extractImagesFromTroop=nt;exports.extractNoteText=L;exports.extractPageCondition=ve;exports.extractTextData=c;exports.extractTextFromActor=Xr;exports.extractTextFromArmor=Zr;exports.extractTextFromClass=qr;exports.extractTextFromCommonEvent=tt;exports.extractTextFromEnemy=Yr;exports.extractTextFromEventCommands=D;exports.extractTextFromEventPages=G;exports.extractTextFromItem=Qr;exports.extractTextFromMap=it;exports.extractTextFromSkill=Kr;exports.extractTextFromState=$r;exports.extractTextFromTroop=rt;exports.extractTextFromWeapon=Ur;exports.extractTextMapper=pe;exports.extractVariableInfos=Fe;exports.extractVariableReadingFromCommonEvent=ft;exports.extractVariableReadingFromMap=bt;exports.extractVariableReadingFromTroop=Et;exports.extractVariableReference=Ce;exports.extractVariableWritsFromControlVariable=Ie;exports.extractVariableWritsFromEventCommand=pt;exports.isAudioResource=Dr;exports.isVariableReadCommand=Te;exports.isVariableWriteCommand=gt;exports.readScript=be;exports.systemAudioFiles=Jr;
//# sourceMappingURL=rpg-analyzer.cjs.js.map
